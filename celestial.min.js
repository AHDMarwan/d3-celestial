// Copyright 2015 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function t(t,e){var n=a(t.map(function(t){return t*f}),e);return n.map(function(t){return t/f})}function a(t,a){var e,n,r,l,i,o,f,u,h,d,g=1e-5;return a?(o=t[0],0>o&&(o+=s),f=t[1],o-=a[0],l=a[1],i=a[2],e=Math.sin(f)*Math.sin(l)-Math.cos(f)*Math.cos(l)*Math.cos(o),Math.abs(e)<g&&(e=-Math.cos(f+l)+Math.cos(f)*Math.cos(l)*(1-Math.cos(o))),n=-Math.cos(f)*Math.sin(o),u=0!==e||0!==n?Math.atan2(n,e):o-Math.PI,h=i+u,h>Math.PI&&(h-=s),o%Math.PI===0?(d=f+Math.cos(o)*l,d>c&&(d=Math.PI-d),-c>d&&(d=-Math.PI-d)):(r=Math.sin(f)*Math.cos(l)+Math.cos(f)*Math.sin(l)*Math.cos(o),Math.abs(r)>.99?(d=Math.abs(Math.acos(Math.sqrt(e*e+n*n))),0>r&&(d*=-1)):d=Math.asin(r)),[h,d]):t}function e(t){return document.getElementById(t)}function n(t){return t+"px"}function r(t,a){return null!==t&&hasOwnProperty.call(t,a)}var l={version:"0.5.0",container:null,data:[]};l.display=function(a){function s(){if(!(S.width&&S.width>0)){N=I(),O=N/B;var t=H.scale*N/1024;tt.attr("width",N).attr("height",O),X.scale([t]),U.translate([N/2,O/2]).scale([t]),V.translate([N/2,O/2]),C&&(C.style.height=n(O)),M()}}function f(t){return H.clip&&d3.geo.distance(Z,t)>c?0:1}function m(t){return"translate("+U(t)+")"}function v(t){var a=f(t);return"stroke-opacity:"+a+";fill-opacity:"+a}function y(t){at.fillStyle=t.fill,at.strokeStyle=t.stroke||null,at.lineWidth=t.width||null,at.globalAlpha=t.opacity||1,at.font=t.font,at.setLineDash(r(t,"dash")?t.dash:[]),at.beginPath()}function b(t){at.fillStyle=t.fill,at.textAlign=t.align||"left",at.textBaseline=t.baseline||"bottom",at.globalAlpha=t.opacity||1,at.font=t.font}function M(){var t=U.rotate();V.scale(U.scale()),S.adaptable&&(K=Math.sqrt(U.scale()/R)),Q=S.stars.size*K,Z=[-t[0],-t[1]],T(),y(S.background),G.selectAll(".outline").attr("d",rt),at.fill(),G.selectAll(".mw").each(function(t){y(S.mw.style),nt(t),at.fill()});for(var a in S.lines)r(S.lines,a)&&(y(S.lines[a]),G.selectAll("."+a).attr("d",nt),at.stroke());b(S.constellations.namestyle),G.selectAll(".constname").each(function(t){if(f(t.geometry.coordinates)){var a=d3.select(this),e=U(t.geometry.coordinates);at.fillText(a.attr("text"),e[0],e[1])}}),G.selectAll(".constline").each(function(t){y(S.constellations.linestyle),nt(t),at.stroke()}),G.selectAll(".boundaryline").each(function(t){y(S.constellations.boundstyle),nt(t),at.stroke()}),y(S.stars.style),G.selectAll(".star").each(function(t){if(f(t.geometry.coordinates)&&t.properties.mag<=S.stars.limit){var a=d3.select(this),e=U(t.geometry.coordinates),n=x(t);at.fillStyle=a.attr("fill"),at.beginPath(),at.arc(e[0],e[1],n,0,2*Math.PI),at.closePath(),at.fill(),S.stars.names&&t.properties.mag<=S.stars.namelimit&&(b(S.stars.namestyle),at.fillText(a.attr("text"),e[0]+2,e[1]+2))}}),G.selectAll(".dso").each(function(t){if(f(t.geometry.coordinates)&&w(t.properties,S.dsos.limit)){var a=d3.select(this),e=U(t.geometry.coordinates),n=t.properties.type;y(S.dsos.symbols[n]);var l=k(t,e);r(S.dsos.symbols[n],"stroke")?at.stroke():at.fill(),S.dsos.names&&w(t.properties,S.dsos.namelimit)&&(b(S.dsos.namestyle),at.fillStyle=S.dsos.symbols[n].fill,at.fillText(a.attr("text"),e[0]+l,e[1]+l))}}),l.data.length>0&&l.data.forEach(function(t){t.redraw()}),y(S.background),G.selectAll(".outline").attr("d",rt),at.stroke()}function w(t,a){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>a||999!==t.mag&&t.mag<=a}function k(t,a){var e=t.properties,n=z(e)||9,r=P(e.type);return p.symbol().type(r).size(n).position(a)(at),Math.sqrt(n)/2}function P(t){return t&&r(S.dsos.symbols,t)?S.dsos.symbols[t].shape:"circle"}function z(t){return t.mag&&999!=t.mag?Math.pow(2*Q-t.mag,1.4):Math.pow(parseInt(t.dim)*Q/7,.5)}function q(t){var a=t.properties;if(""!==a.name)return S.dsos.desig&&a.desig?a.desig:a.name}function A(t){var a=t.properties.name;if(S.stars.desig!==!1||""!==a)return S.stars.proper&&""!==a?a:S.stars.desig?t.properties.desig:void 0}function x(t){var a=t.properties.mag;if(null===a)return.1;var e=Q*Math.exp($*(a+2));return Math.max(e,.1)}function j(t){var a=t.properties.bv;return!S.stars.colors||isNaN(a)?S.stars.style.fill:d(a)}function T(){at.clearRect(0,0,N+L[0],O+L[1])}function I(){return S.width&&S.width>0?S.width:C&&""!==C.style.width&&"100%"!==C.style.width?C.clientWidth-L[0]:window.innerWidth-2*L[0]}function E(t){var a=i.equatorial,e=0;return t&&"equatorial"===W?[a[0]-t[0],a[1]-t[1],a[2]]:(("equatorial"===W||"ecliptic"===W)&&(e=180),[a[0]-e,a[1],a[2]])}var _,D,G=l.container,S=h.set(a);S.stars.size=S.stars.size||7;var C=e(S.container);if(C){D="#"+S.container;var F=window.getComputedStyle(C,null);parseInt(F.width)||S.width||(C.style.width=n(window.innerWidth))}else D="body",C=null;if(r(g,S.projection)){var H=g[S.projection],W=S.transform||"equatorial",B=H.ratio||2,L=[16,16],N=I(),O=N/B,R=H.scale*N/1024,Q=S.stars.size,$=-.3,K=1,Y=E(S.center),Z=[-Y[0],-Y[1]],J=S.datapath||"";J=J.replace(/([^\/]$)/,"$1/"),"body"!=D&&(e(S.container).style.height=n(O));var U=l.projection(S.projection).rotate(Y).translate([N/2,O/2]).scale([R]),V=l.projection(S.projection).translate([N/2,O/2]).scale([R]);H.clip&&(U.clipAngle(90),_=d3.geo.circle().angle([90]));var X=d3.geo.zoom().projection(U).center([N/2,O/2]).scaleExtent([R,5*R]).on("zoom.redraw",M),tt=d3.selectAll("canvas");0===tt[0].length&&(tt=d3.select(D).append("canvas")),tt.attr("width",N).attr("height",O);var at=tt.node().getContext("2d"),et=d3.geo.graticule().minorStep([15,10]),nt=d3.geo.path().projection(U).context(at),rt=d3.geo.path().projection(V).context(at);G?G.selectAll("*").remove():G=d3.select(D).append("container"),S.interactive?tt.call(X):tt.attr("style","cursor: default!important"),_?G.append("path").datum(_).attr("class","outline"):G.append("path").datum(et.outline).attr("class","outline"),S.lines.graticule.show&&G.append("path").datum(et).attr("class","graticule");for(var lt in S.lines)if(r(S.lines,lt)){if("graticule"===lt||S.lines[lt].show===!1)continue;G.append("path").datum(d3.geo.circle().angle([90]).origin(t(o[lt],u[W]))).attr("class",lt)}S.mw.show&&d3.json(J+"mw.json",function(t,a){if(t)return window.alert("Your Browser doesn't support local file loading or the file doesn't exist. See readme.md"),console.warn(t);var e=getData(a,W);G.selectAll(".mway").data(e.features).enter().append("path").attr("class","mw"),M()}),S.constellations.show&&(d3.json(J+"constellations.json",function(t,a){if(t)return console.warn(t);var e=getData(a,W);S.constellations.names&&(G.selectAll(".constnames").data(e.features).enter().append("text").attr("class","constname").attr("text",function(t){return S.constellations.names?S.constellations.desig?t.properties.desig:t.properties.name:void 0}),M())}),S.constellations.bounds&&d3.json(J+"constellations.bounds.json",function(t,a){if(t)return console.warn(t);var e=getData(a,W);G.selectAll(".bounds").data(e.features).enter().append("path").attr("class","boundaryline"),M()}),S.constellations.lines&&d3.json(J+"constellations.lines.json",function(t,a){if(t)return console.warn(t);var e=getData(a,W);G.selectAll(".lines").data(e.features).enter().append("path").attr("class","constline"),M()})),S.stars.show&&d3.json(J+S.stars.data,function(t,a){if(t)return console.warn(t);var e=getData(a,W);G.selectAll(".stars").data(e.features).enter().append("path").attr("class","star").attr("text",A).attr("fill",j),M()}),S.dsos.show&&d3.json(J+S.dsos.data,function(t,a){if(t)return console.warn(t);var e=getData(a,W);G.selectAll(".dsos").data(e.features).enter().append("path").attr("class","dso").attr("text",q),M()}),this.data.length>0&&this.data.forEach(function(t){r(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this),d3.select(window).on("resize",s),this.container=G,this.clip=f,this.point=m,this.opacity=v,this.map=nt,this.mapProjection=U,this.resize=function(){s()}}},l.projection=function(t){var a,e,n;if(!r(g,t))throw new Error("Projection not supported: "+t);return a=g[t],e=null!==a.arg?d3.geo[t].raw(a.arg):d3.geo[t].raw,n=function(t,a){var n=e(-t,a);return n},n.invert=function(t,a){var n=e.invert(t,a);return n[0]*=-1,n},d3.geo.projection(n)};var i={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},o={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};l.eulerAngles=function(){return i},l.poles=function(){return o};var s=2*Math.PI,c=Math.PI/2,f=Math.PI/180;l.graticule=function(a,e,n){var r;if(n&&"equatorial"!=n){for(r=10;170>=r;r+=10)a.append("path").datum(d3.geo.circle().angle([r]).origin(o[n])).attr("class","gridline").attr("d",e);for(r=10;180>=r;r+=10)a.append("path").datum(d3.geo.circle().angle([90]).origin(t([r,0],u["inverse "+n]))).attr("class","gridline").attr("d",e)}};var u={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*f}))},add:function(t,a){return a&&t&&3===a.length&&!this.hasOwnProperty(t)?(this[t]=a.map(function(t){return t*f}),this[t]):void 0}};u.init(),l.euler=function(){return u},l.add=function(t){var a={};return r(t,"type")?"dso"!==t.type||r(t,"file")&&r(t,"callback")?"line"!==t.type||r(t,"callback")?(r(t,"file")&&(a.file=t.file),a.type=t.type,r(t,"callback")&&(a.callback=t.callback),r(t,"redraw")&&(a.redraw=t.redraw),void l.data.push(a)):console.log("Can't add line"):console.log("Can't add data file"):console.log("Missing type")};var h={width:0,projection:"aitoff",transform:"equatorial",center:null,background:{fill:"#000000",stroke:"#000000",opacity:1},adaptable:!0,interactive:!0,form:!0,container:"map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},names:!0,proper:!1,desig:!0,namestyle:{fill:"#ddddbb",font:"11px Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},namelimit:2.5,size:7,data:"stars.6.json"},dsos:{show:!0,limit:6,names:!0,desig:!0,namestyle:{fill:"#cccccc",font:"11px Helvetica, Arial, serif",align:"left",baseline:"top"},namelimit:4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ffcc00",stroke:"#ffcc00",width:1.5},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc",stroke:"#ff00cc",width:2},sfr:{shape:"square",fill:"#cc00ff",stroke:"#cc00ff",width:2},rn:{shape:"square",fill:"#00ooff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,desig:!0,namestyle:{fill:"#cccc99",font:"12px Helvetica, Arial, sans-serif",align:"center",baseline:"middle"},lines:!0,linestyle:{stroke:"#cccccc",width:1,opacity:.6},bounds:!1,boundstyle:{stroke:"#cccc00",width:.5,opacity:.8,dash:[2,4]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},set:function(t){var a,e,n={};if(!t)return this;for(a in this)if(r(this,a)&&"function"!=typeof this[a])if(r(t,a)&&null!==t[a])if(null===this[a]||this[a].constructor!=Object)n[a]=t[a];else{n[a]={};for(e in this[a])n[a][e]=r(t[a],e)?t[a][e]:this[a][e]}else n[a]=this[a];return n}};l.settings=function(){return h};var d=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),g={airy:{n:"Airy",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus",arg:1,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/4,scale:230,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:"Craster",arg:null,scale:160},cylindricalEqualArea:{n:"Cylindrical Equal Area",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:"Cylindrical Stereographic",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:"Eckert 1",arg:null,scale:175},eckert2:{n:"Eckert 2",arg:null,scale:175},eckert3:{n:"Eckert 3",arg:null,scale:190},eckert4:{n:"Eckert 4",arg:null,scale:190},eckert5:{n:"Eckert 5",arg:null,scale:182},eckert6:{n:"Eckert 6",arg:null,scale:182},eisenlohr:{n:"Eisenlohr",arg:null,scale:102},equirectangular:{n:"Equirectangular",arg:null,scale:165},fahey:{n:"Fahey",arg:null,scale:196,ratio:1.4},foucaut:{n:"Foucaut",arg:null,scale:142},ginzburg4:{n:"Ginzburg 4",arg:null,scale:180,ratio:1.7},ginzburg5:{n:"Ginzburg 5",arg:null,scale:196,ratio:1.55},ginzburg6:{n:"Ginzburg 6",arg:null,scale:190,ratio:1.4},ginzburg8:{n:"Ginzburg 8",arg:null,scale:205,ratio:1.3},ginzburg9:{n:"Ginzburg 9",arg:null,scale:190,ratio:1.4},hammer:{n:"Hammer",arg:2,scale:180},hatano:{n:"Hatano",arg:null,scale:186},healpix:{n:"HEALPix",arg:1,scale:320,ratio:1.2},hill:{n:"Hill",arg:2,scale:195,ratio:1.5},homolosine:{n:"Homolosine",arg:null,scale:160,ratio:2.2},kavrayskiy7:{n:"Kavrayskiy 7",arg:null,scale:185,ratio:1.75},lagrange:{n:"Lagrange",arg:Math.PI/4,scale:88,ratio:2,clip:!1},larrivee:{n:"l'Arrivee",arg:null,scale:160,ratio:1.25},laskowski:{n:"Laskowski",arg:null,scale:165,ratio:1.7},loximuthal:{n:"Loximuthal",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:"Mercator",arg:null,scale:160,ratio:1.3},miller:{n:"Miller",arg:null,scale:160,ratio:1.5},mollweide:{n:"Mollweide",arg:null,scale:180},mtFlatPolarParabolic:{n:"Flat Polar Parabolic",arg:null,scale:175},mtFlatPolarQuartic:{n:"Flat Polar Quartic",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{n:"Flat Polar Sinusoidal",arg:null,scale:175,ratio:1.9},naturalEarth:{n:"Natural Earth",arg:null,scale:185,ratio:1.85},nellHammer:{n:"Nell Hammer",arg:null,scale:160,ratio:2.6},orthographic:{n:"Orthographic",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:"Patterson",arg:null,scale:160,ratio:1.75},polyconic:{n:"Polyconic",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:"Rectangular Polyconic",arg:0,scale:160,ratio:1.65},robinson:{n:"Robinson",arg:null,scale:160},sinusoidal:{n:"Sinusoidal",arg:null,scale:160,ratio:2},stereographic:{n:"Stereographic",arg:null,scale:500,ratio:1,clip:!0},times:{n:"Times",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:"2 Point Equidistant",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:"van Der Grinten",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:"van Der Grinten 2",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:"van Der Grinten 3",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:"van Der Grinten 4",arg:null,scale:160,ratio:1.6},wagner4:{n:"Wagner 4",arg:null,scale:185},wagner6:{n:"Wagner 6",arg:null,scale:160},wagner7:{n:"Wagner 7",arg:null,scale:190,ratio:1.8},wiechel:{n:"Wiechel",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:"Winkel Tripel",arg:null,scale:196,ratio:1.7}};l.projections=function(){return g};var p={};p.symbol=function(){function t(t){l[e()](t)}var a,e=d3.functor("circle"),n=d3.functor(64),r=(d3.functor("#fff"),d3.functor("")),l=(d3.functor([2,2]),{circle:function(t){var e=Math.sqrt(n()),r=e/2;return t.arc(a[0],a[1],r,0,2*Math.PI),r},square:function(t){var e=Math.sqrt(n()),r=e/2;return t.moveTo(a[0]-r,a[1]-r),t.lineTo(a[0]+r,a[1]-r),t.lineTo(a[0]+r,a[1]+r),t.lineTo(a[0]-r,a[1]+r),t.closePath(),r},diamond:function(t){var e=Math.sqrt(n()),r=e/2;return t.moveTo(a[0],a[1]-r),t.lineTo(a[0]+r,a[1]),t.lineTo(a[0],a[1]+r),t.lineTo(a[0]-r,a[1]),t.closePath(),r},ellipse:function(t){var e=Math.sqrt(n()),r=e/2;return t.save(),t.translate(a[0],a[1]),t.scale(1.6,.8),t.beginPath(),t.arc(0,0,r,0,2*Math.PI),t.closePath(),t.restore(),r},marker:function(t){var e=Math.sqrt(n()),r=e/2;return t.moveTo(a[0],a[1]-e),t.lineTo(a[0],a[1]+e),t.moveTo(a[0]-e,a[1]),t.lineTo(a[0]+e,a[1]),t.closePath(),r},"cross-circle":function(t){var e=Math.sqrt(n()),r=e/2;return t.moveTo(a[0],a[1]-e),t.lineTo(a[0],a[1]+e),t.moveTo(a[0]-e,a[1]),t.lineTo(a[0]+e,a[1]),t.moveTo(a[0],a[1]),t.arc(a[0],a[1],r,0,2*Math.PI),t.closePath(),r},"stroke-circle":function(t){var e=Math.sqrt(n()),r=e/2;return t.moveTo(a[0],a[1]-e),t.lineTo(a[0],a[1]+e),t.moveTo(a[0],a[1]),t.arc(a[0],a[1],r,0,2*Math.PI),t.closePath(),r}});return t.type=function(a){return arguments.length?(e=d3.functor(a),t):e},t.size=function(a){return arguments.length?(n=d3.functor(a),t):n},t.text=function(a){return arguments.length?(r=d3.functor(a),t):r},t.position=function(e){return arguments.length?(a=e,t):void 0},t},function(){function t(t,a,e){var n=t.translate(),r=Math.atan2(a[1]-n[1],a[0]-n[0])-Math.atan2(e[1]-n[1],e[0]-n[0]);return[Math.cos(r/2),0,0,Math.sin(r/2)]}function a(t,a){var e=t.invert(a);return e&&isFinite(e[0])&&isFinite(e[1])&&o(e)}function e(t){var a=.5*t[0]*u,e=.5*t[1]*u,n=.5*t[2]*u,r=Math.sin(a),l=Math.cos(a),i=Math.sin(e),o=Math.cos(e),s=Math.sin(n),c=Math.cos(n);return[l*o*c+r*i*s,r*o*c-l*i*s,l*i*c+r*o*s,l*o*s-r*i*c]}function n(t,a){var e=t[0],n=t[1],r=t[2],l=t[3],i=a[0],o=a[1],s=a[2],c=a[3];return[e*i-n*o-r*s-l*c,e*o+n*i+r*c-l*s,e*s-n*c+r*i+l*o,e*c+n*s-r*o+l*i]}function r(t,a){if(t&&a){var e=c(t,a),n=Math.sqrt(s(e,e)),r=.5*Math.acos(Math.max(-1,Math.min(1,s(t,a)))),l=Math.sin(r)/n;return n&&[Math.cos(r),e[2]*l,-e[1]*l,e[0]*l]}}function l(t,a){var e=Math.max(-1,Math.min(1,s(t,a))),n=0>e?-1:1,r=Math.acos(n*e),l=Math.sin(r);return l?function(e){var i=n*Math.sin((1-e)*r)/l,o=Math.sin(e*r)/l;return[t[0]*i+a[0]*o,t[1]*i+a[1]*o,t[2]*i+a[2]*o,t[3]*i+a[3]*o]}:function(){return t}}function i(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*h,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*h,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*h]}function o(t){var a=t[0]*u,e=t[1]*u,n=Math.cos(e);return[n*Math.cos(a),n*Math.sin(a),Math.sin(e)]}function s(t,a){for(var e=0,n=t.length,r=0;n>e;++e)r+=t[e]*a[e];return r}function c(t,a){return[t[1]*a[2]-t[2]*a[1],t[2]*a[0]-t[0]*a[2],t[0]*a[1]-t[1]*a[0]]}function f(t){for(var a=0,e=arguments.length,n=[];++a<e;)n.push(arguments[a]);var r=d3.dispatch.apply(null,n);return r.of=function(a,e){return function(n){try{var l=n.sourceEvent=d3.event;n.target=t,d3.event=n,r[n.type].apply(a,e)}finally{d3.event=l}}},r}var u=Math.PI/180,h=180/Math.PI;d3.geo.zoom=function(){function s(t){p++||t({type:"zoomstart"})}function c(t){t({type:"zoom"})}function u(t){--p||t({type:"zoomend"})}var h,d,g,p=0,m=f(v,"zoomstart","zoom","zoomend"),v=d3.behavior.zoom().on("zoomstart",function(){var l=d3.mouse(this),o=e(h.rotate()),f=a(h,l);f&&(g=f),y.call(v,"zoom",function(){h.scale(b.k=d3.event.scale);var e=d3.mouse(this),s=r(g,a(h,e));h.rotate(b.r=i(o=s?n(o,s):n(t(h,l,e),o))),l=e,c(m.of(this,arguments))}),s(m.of(this,arguments))}).on("zoomend",function(){y.call(v,"zoom",null),u(m.of(this,arguments))}),y=v.on,b={r:[0,0,0],k:1};return v.rotateTo=function(t){var a=r(o(t),o([-b.r[0],-b.r[1]]));return i(n(e(b.r),a))},v.projection=function(t){return arguments.length?(h=t,b={r:h.rotate(),k:h.scale()},v.scale(b.k)):h},v.duration=function(t){return arguments.length?(d=t,v):d},v.event=function(t){t.each(function(){var t=d3.select(this),a=m.of(this,arguments),n=b,r=d3.transition(t);if(r!==t){r.each("start.zoom",function(){this.__chart__&&(b=this.__chart__),h.rotate(b.r).scale(b.k),s(a)}).tween("zoom:zoom",function(){var t=v.size()[0],o=l(e(b.r),e(n.r)),s=d3.geo.distance(b.r,n.r),f=d3.interpolateZoom([0,0,t/b.k],[s,0,t/n.k]);return d&&r.duration(d(.001*f.duration)),function(e){var n=f(e);this.__chart__=b={r:i(o(n[0]/s)),k:t/n[2]},h.rotate(b.r).scale(b.k),v.scale(b.k),c(a)}}).each("end.zoom",function(){u(a)});try{r.each("interrupt.zoom",function(){u(a)})}catch(o){console.log(o)}}else this.__chart__=b,s(a),c(a),u(a)})},d3.rebind(v,m,"on")}}(),this.Celestial=l}();