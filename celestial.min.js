var settings={width:1024,projection:"aitoff",transform:null,bgcolor:"#000",stars:{show:!0,limit:6,colors:!0,color:"#fff",names:!0,proper:!1,desig:!0,namelimit:2,data:"data/stars.6.json"},dsos:{show:!0,limit:6,names:!0,desig:!0,namelimit:6,data:"data/dsos.bright.json"},constellations:{show:!0,names:!0,desig:!0,lines:!0,bounds:!1},mw:{show:!0,opacity:.55},lines:{graticule:!0,equatorial:!1,ecliptic:!0,galactic:!1,supergalactic:!1}},symbols={gg:{shape:"circle",stroke:"#f00",fill:"#f00"},g:{shape:"ellipse",stroke:"#f00",fill:"#f00"},s:{shape:"ellipse",stroke:"#f00",fill:"#f00"},s0:{shape:"ellipse",stroke:"#f00",fill:"#f00"},sd:{shape:"ellipse",stroke:"#f00",fill:"#f00"},e:{shape:"ellipse",stroke:"#f00",fill:"#f00"},i:{shape:"ellipse",stroke:"#f00",fill:"#f00"},oc:{shape:"circle",stroke:"#fc0",fill:"none"},gc:{shape:"circle",stroke:"#f90",fill:"#f90"},en:{shape:"square",stroke:"#f0c",fill:"#f0c"},bn:{shape:"square",stroke:"#f0c",fill:"none"},sfr:{shape:"square",stroke:"#c0f",fill:"none"},rn:{shape:"square",stroke:"#00f",fill:"#00f"},pn:{shape:"diamond",stroke:"#0cc",fill:"#0cc"},snr:{shape:"diamond",stroke:"#f0c",fill:"#f0c"},dn:{shape:"square",stroke:"#999",fill:"none"}},bvcolor=d3.scale.quantize().domain([-.4,3.332]).range(["#a5b7ff","#a6b9ff","#a7baff","#a8bbff","#a9bcff","#aabcff","#abbeff","#adc0ff","#afc2ff","#b1c4ff","#b3c5ff","#b5c7ff","#b8c9ff","#bbcbff","#bdcdff","#c0ceff","#c3d1ff","#c5d4ff","#c7d7ff","#cad9ff","#cedcff","#d2dfff","#d7e1ff","#dbe4ff","#e0e7ff","#e5e9ff","#e9ecff","#edefff","#f1f2ff","#f4f4ff","#f8f7ff","#fbf8ff","#fdf9ff","#fffafe","#fffbfd","#fffbfc","#fffbfb","#fffaf7","#fff9f3","#fff8f0","#fff7ec","#fff6e7","#fff5e1","#fff3dc","#fff2d7","#fff0cf","#ffedc8","#ffeac1","#ffe8ba","#ffe5b3","#ffe2ad","#ffe0a6","#ffdda1","#ffda9b","#ffd896","#ffd790","#ffd58c","#ffd387","#ffd183","#ffcf7f","#ffce7c","#ffcd79","#ffcc77","#ffcb75","#ffca74","#ffc870","#ffc76f","#ffc66e","#ffc56d","#ffc46c","#ffc36b","#ffc26a","#ffc169","#ffc068","#ffbf67","#ffbe66","#ffbd65","#ffbc64","#ffbb63","#ffba62","#ffb961","#ffb860","#ffb75f","#ffb65e","#ffb55d","#ffb45c","#ffb35b","#ffb25a","#ffb159","#ffb058","#ffaf57","#ffar56","#ffad55","#ffac54","#ffab53","#ffaa52","#ffa951","#ffa850","#ffa74f","#ffa64e","#ffa54d","#ffa44c","#ffa34b","#ffa24a","#ffa149","#ffa048","#ff9f47","#ff9e46","#ff9d45","#ff9c44","#ff9b43","#ff9a42","#ff9941","#ff983f","#ff973e"]),projections={airy:{arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{arg:null,scale:162},armadillo:{arg:0,scale:250},august:{arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{arg:null,scale:220,ratio:1,clip:!0},azimuthalEquidistant:{arg:null,scale:150,ratio:1,clip:!0},baker:{arg:null,scale:160,ratio:1.4},berghaus:{arg:1,scale:320,ratio:1,clip:!0},boggs:{arg:null,scale:170},bonne:{arg:Math.PI/4,scale:230,ratio:.88},bromley:{arg:null,scale:162},collignon:{arg:null,scale:100,ratio:2.6},craig:{arg:0,scale:310,ratio:1.5,clip:!0},craster:{arg:null,scale:160},cylindricalEqualArea:{arg:Math.PI/6,scale:180},cylindricalStereographic:{arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{arg:null,scale:175},eckert2:{arg:null,scale:175},eckert3:{arg:null,scale:190},eckert4:{arg:null,scale:190},eckert5:{arg:null,scale:182},eckert6:{arg:null,scale:182},eisenlohr:{arg:null,scale:102},equirectangular:{arg:null,scale:160},fahey:{arg:null,scale:196,ratio:1.4},foucaut:{arg:null,scale:142},ginzburg4:{arg:null,scale:180,ratio:1.7},ginzburg5:{arg:null,scale:196,ratio:1.55},ginzburg6:{arg:null,scale:190,ratio:1.4},ginzburg8:{arg:null,scale:205,ratio:1.3},ginzburg9:{arg:null,scale:190,ratio:1.4},gringorten:{arg:null,scale:360,ratio:1,clip:!0},hammer:{arg:2,scale:180},hatano:{arg:null,scale:186},healpix:{arg:1,scale:300,ratio:1.2},hill:{arg:2,scale:190,ratio:1.6},homolosine:{arg:null,scale:160,ratio:2.2},kavrayskiy7:{arg:null,scale:185,ratio:1.75},lagrange:{arg:Math.PI/2,scale:88,ratio:1.7,clip:!0},larrivee:{arg:null,scale:160,ratio:1.25},laskowski:{arg:null,scale:165,ratio:1.7},loximuthal:{arg:Math.PI/4,scale:170,ratio:1.8},mercator:{arg:null,scale:160,ratio:1.3},miller:{arg:null,scale:160,ratio:1.5},mollweide:{arg:null,scale:180},mtFlatPolarParabolic:{arg:null,scale:175},mtFlatPolarQuartic:{arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{arg:null,scale:175,ratio:1.9},naturalEarth:{arg:null,scale:185,ratio:1.85},nellHammer:{arg:null,scale:160,ratio:2.6},orthographic:{arg:null,scale:480,ratio:1,clip:!0},patterson:{arg:null,scale:160,ratio:1.75},polyconic:{arg:null,scale:160,ratio:1.3},rectangularPolyconic:{arg:0,scale:160,ratio:1.65},robinson:{arg:null,scale:160},sinusoidal:{arg:null,scale:160,ratio:2},stereographic:{arg:null,scale:480,ratio:1,clip:!0},times:{arg:null,scale:210,ratio:1.4},twoPointEquidistant:{arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{arg:null,scale:160,ratio:1},vanDerGrinten2:{arg:null,scale:160,ratio:1},vanDerGrinten3:{arg:null,scale:160,ratio:1},vanDerGrinten4:{arg:null,scale:160,ratio:1.6},wagner4:{arg:null,scale:185},wagner6:{arg:null,scale:160},wagner7:{arg:null,scale:190,ratio:1.8},wiechel:{arg:null,scale:360,ratio:1,clip:!0},winkel3:{arg:null,scale:196,ratio:1.7}},Celestial={};Celestial.display=function(t){function e(t){return p.clip&&d3.geo.distance(b,t)>pi_2?0:1}function a(t){return"translate("+v(t)+")"}function r(){if(d3.event){var t=v.rotate();M.scale(v.scale()),M.rotate(v.rotate()),w.scale(v.scale()),b=[-t[0],-t[1]],q.selectAll(".constname").attr("transform",function(t){return a(t.geometry.coordinates)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}),q.selectAll(".constline").attr("d",P),q.selectAll(".boundaryline").attr("d",P),q.selectAll(".star").attr("d",P.pointRadius(function(t){return c(t.properties.mag)})),q.selectAll(".starname").attr("transform",function(t){return a(t.geometry.coordinates)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}),q.selectAll(".dso").attr("transform",function(t){return a(t.geometry.coordinates)}).attr("d",function(t){return s(t.properties)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}).style("stroke-opacity",function(t){return e(t.geometry.coordinates)}),q.selectAll(".dsoname").attr("transform",function(t){return a(t.geometry.coordinates)}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}),q.selectAll(".outline").attr("d",I),q.selectAll(".gridline").attr("d",A),q.selectAll(".mw").attr("d",P),q.selectAll(".ecliptic").attr("d",P),q.selectAll(".equatorial").attr("d",P),q.selectAll(".galactic").attr("d",P),q.selectAll(".supergalactic").attr("d",P)}}function s(t){var e=i(t.mag,t.dim)||9,a=n(t.type);return-1!==d3.svg.symbolTypes.indexOf(a)?d3.svg.symbol().type(a).size(e)():d3.svg.customSymbol().type(a).size(e)()}function n(t){return t&&symbols.hasOwnProperty(t)?symbols[t].shape:"circle"}function l(t,e){return!t.type||!symbols.hasOwnProperty(t.type)||999==t.mag&&Math.sqrt(parseInt(t.dim))<settings.dsos.limit||999!=t.mag&&t.mag>settings.dsos.limit?"none":symbols[t.type][e]}function i(t,e){return t&&999!=t?Math.pow(14-t,1.4):Math.pow(parseInt(e),.5)}function o(t){return 999==t.mag&&Math.sqrt(parseInt(t.dim))<settings.dsos.namelimit||999!=t.mag&&t.mag>settings.dsos.namelimit||""===t.name?void 0:settings.dsos.desig&&t.desig?t.desig:t.name}function f(t){return t.mag>settings.stars.namelimit||settings.stars.desig===!1&&""===t.name?void 0:settings.stars.proper&&""!==t.name?t.name:settings.stars.desig?t.desig:void 0}function c(t){if(null===t)return.3;var e=Math.pow(6-t,.66);return e>.5?e:.5}function u(t){return t.mag>settings.stars.limit?"rgba(0,0,0,0)":!settings.stars.colors||t.mag>5?settings.stars.color:bvcolor(t.bv)}var g,d=function(){var e,a;for(e in settings)if(t.hasOwnProperty(e)&&null!==t[e])if(settings[e].constructor!=Object)settings[e]=t[e];else for(a in settings[e])t[e].hasOwnProperty(a)&&(settings[e][a]=t[e][a])};if(t&&d(t),projections.hasOwnProperty(settings.projection)){var p=projections[settings.projection],m=p.ratio||2,h=settings.width,y=h/m,b=[180,0,0],v=Celestial.projection(settings.projection,settings.transform).rotate(b).translate([h/2,y/2]).scale([p.scale]),M=Celestial.projection(settings.projection).rotate(b).translate([h/2,y/2]).scale([p.scale]),w=Celestial.projection(settings.projection).translate([h/2,y/2]).scale([p.scale]);p.clip&&(v.clipAngle(90),M.clipAngle(90),g=d3.geo.circle().angle([90]));var j=d3.geo.zoom().projection(v).center([h/2,y/2]).scaleExtent([.8*p.scale,4*p.scale]).on("zoom",r),k=d3.geo.graticule().minorStep([15,10]),P=d3.geo.path().projection(v),A=d3.geo.path().projection(M),I=d3.geo.path().projection(w),q=d3.select("body").append("svg").attr("width",h).attr("height",y).call(j);g?q.append("path").datum(g).attr("class","outline").attr("d",I):q.append("path").datum(k.outline).attr("class","outline").attr("d",A),settings.lines.graticule&&q.append("path").datum(k).attr("class","gridline").attr("d",A),settings.mw.show&&d3.json("data/mw.json",function(t,e){q.selectAll(".mway").data(e.features).enter().append("path").attr("class","mw").attr("d",P)}),settings.constellations.show&&(d3.json("data/constellations.json",function(t,r){q.selectAll(".constnames").data(r.features).enter().append("text").attr("class","constname").attr("transform",function(t){return a(t.geometry.coordinates)}).text(function(t){return settings.constellations.names?settings.constellations.desig?t.properties.desig:t.properties.name:void 0}).style("fill-opacity",function(t){return e(t.geometry.coordinates)})}),settings.constellations.bounds&&d3.json("data/constellations.bounds.json",function(t,e){q.selectAll(".bounds").data(e.features).enter().append("path").attr("class","boundaryline").attr("d",P)}),settings.constellations.lines&&d3.json("data/constellations.lines.json",function(t,e){q.selectAll(".lines").data(e.features).enter().append("path").attr("class","constline").attr("d",P)})),settings.stars.show&&d3.json(settings.stars.data,function(t,r){q.selectAll(".stars").data(r.features).enter().append("path").attr("class","star").attr("d",P.pointRadius(function(t){return c(t.properties.mag)})).style("fill",function(t){return u(t.properties)}),settings.stars.names&&q.selectAll(".starnames").data(r.features).enter().append("text").attr("transform",function(t){return a(t.geometry.coordinates)}).text(function(t){return f(t.properties)}).attr("dy","-.5em").attr("dx",".35em").attr("class","starname").style("fill-opacity",function(t){return e(t.geometry.coordinates)})}),settings.dsos.show&&d3.json(settings.dsos.data,function(t,r){q.selectAll(".dsos").data(r.features).enter().append("path").attr("class","dso").attr("transform",function(t){return a(t.geometry.coordinates)}).attr("d",function(t){return s(t.properties)}).style("stroke",function(t){return l(t.properties,"stroke")}).style("fill",function(t){return l(t.properties,"fill")}).style("fill-opacity",function(t){return e(t.geometry.coordinates)}).style("stroke-opacity",function(t){return e(t.geometry.coordinates)}),settings.dsos.names&&q.selectAll(".dsonames").data(r.features).enter().append("text").attr("class","dsoname").attr("transform",function(t){return a(t.geometry.coordinates)}).text(function(t){return o(t.properties)}).attr("dy","-.5em").attr("dx",".35em").style("fill",function(t){return l(t.properties,"stroke")}).style("fill-opacity",function(t){return e(t.geometry.coordinates)})});for(var z in settings.lines)if(settings.lines.hasOwnProperty(z)&&"graticule"!=z&&settings.lines[z]!==!1){var x=Celestial.plane(z);q.selectAll(".pl"+z).data(x.features).enter().append("path").attr("d",P).attr("class",z)}}},Celestial.projection=function(t,e){var a,r,s;if(!projections.hasOwnProperty(t))throw new Error("Projection not supported: "+t);return a=projections[t],r=null!==a.arg?d3.geo[t].raw(a.arg):d3.geo[t].raw,s=e?function(t,a){var s=Celestial.transform([-t,a],e);return s=r(s[0],s[1])}:function(t,e){var a=r(-t,e);return a},s.invert=function(t,e){var a=r.invert(t,e);return a[0]*=-1,a},d3.geo.projection(s)};var pi2=2*Math.PI,pi_2=Math.PI/2,deg2rad=Math.PI/180;Celestial.plane=function(t){var e,a,r=[],s=function(t,e){var a={type:"FeatureCollection",features:[]};return a.features[0]={type:"Feature",id:t,properties:{},geometry:{}},a.features[0].geometry.type="LineString",a.features[0].geometry.coordinates=e,a};if("equatorial"==t)for(e=-180;180>=e;e+=1)r.push([e,0]);else{if(a="inverse "+t,!euler.hasOwnProperty(a))return null;for(e=-Math.PI;e<=Math.PI;e+=.01)r.push(Celestial.transform([e,0],euler[a]).map(function(t){return t/deg2rad}))}return s(t,r)},Celestial.transform=function(t,e){var a,r,s,n,l,i,o,f,c,u,g=1e-5;return e?(i=t[0],0>i&&(i+=pi2),o=t[1],i-=e[0],n=e[1],l=e[2],a=Math.sin(o)*Math.sin(n)-Math.cos(o)*Math.cos(n)*Math.cos(i),Math.abs(a)<g&&(a=-Math.cos(o+n)+Math.cos(o)*Math.cos(n)*(1-Math.cos(i))),r=-Math.cos(o)*Math.sin(i),f=0!==a||0!==r?Math.atan2(r,a):i-Math.PI,c=l+f,c>Math.PI&&(c-=pi2),i%Math.PI===0?(u=o+Math.cos(i)*n,u>pi_2&&(u=Math.PI-u),-pi_2>u&&(u=-Math.PI-u)):(s=Math.sin(o)*Math.cos(n)+Math.cos(o)*Math.sin(n)*Math.cos(i),Math.abs(s)>.99?(u=Math.abs(Math.acos(Math.sqrt(a*a+r*r))),0>s&&(u*=-1)):u=Math.asin(s)),[c,u]):t};var euler={ecliptic:[270,23.4393,90],"inverse ecliptic":[90,23.4393,270],galactic:[192.8595,62.8717,122.9319],"inverse galactic":[238.9319,62.8717,192.8595],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[334.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*deg2rad}))},add:function(t,e){return e&&t&&3===e.length&&!this.hasOwnProperty(t)?(this[t]=e.map(function(t){return t*deg2rad}),this[t]):void 0}};euler.init();var customSymbolTypes=d3.map({ellipse:function(t){var e=Math.sqrt(t),a=.666*e,r=e/3;return"M"+-a+","+-r+" m"+-a+",0 a"+a+","+r+" 0 1,0"+2*a+",0 a"+a+","+r+" 0 1,0"+-(2*a)+",0"}});d3.svg.customSymbol=function(){function t(t,r){return customSymbolTypes.get(e.call(this,t,r))(a.call(this,t,r))}var e,a=64;return t.type=function(a){return arguments.length?(e=d3.functor(a),t):e},t.size=function(e){return arguments.length?(a=d3.functor(e),t):a},t};