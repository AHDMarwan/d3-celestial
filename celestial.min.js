// Copyright 2015 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function t(t,e){function a(a,r){var i=t([a*=180/Math.PI,r*=180/Math.PI]),o=e([a,r]);return[(1-n)*i[0]+n*o[0],(n-1)*i[1]-n*o[1]]}var n,r=d3.geo.projection(a).scale(1),i=r.center,o=r.translate;return r.alpha=function(a){if(!arguments.length)return n;n=+a;var l=t.center(),s=e.center(),c=t.translate(),p=e.translate();return i([(1-n)*l[0]+n*s[0],(1-n)*l[1]+n*s[1]]),o([(1-n)*c[0]+n*p[0],(1-n)*c[1]+n*p[1]]),r},delete r.translate,delete r.center,r.alpha(0)}function e(t,e){var n=a(t.map(function(t){return t*Z}),e);return n.map(function(t){return t/Z})}function a(t,e){var a,n,r,i,o,l,s,c,p,u,d=1e-5;return e?(l=t[0],0>l&&(l+=J),s=t[1],l-=e[0],i=e[1],o=e[2],a=Math.sin(s)*Math.sin(i)-Math.cos(s)*Math.cos(i)*Math.cos(l),Math.abs(a)<d&&(a=-Math.cos(s+i)+Math.cos(s)*Math.cos(i)*(1-Math.cos(l))),n=-Math.cos(s)*Math.sin(l),c=0!==a||0!==n?Math.atan2(n,a):l-Math.PI,p=o+c,p>Math.PI&&(p-=J),l%Math.PI===0?(u=s+Math.cos(l)*i,u>Q&&(u=Math.PI-u),-Q>u&&(u=-Math.PI-u)):(r=Math.sin(s)*Math.cos(i)+Math.cos(s)*Math.sin(i)*Math.cos(l),Math.abs(r)>.99?(u=Math.abs(Math.acos(Math.sqrt(a*a+n*n))),0>r&&(u*=-1)):u=Math.asin(r)),[p,u]):t}function n(t,e){var a=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=t.getUTCDate(),i=t.getUTCHours(),o=t.getUTCMinutes(),l=t.getUTCSeconds();(1==n||2==n)&&(a-=1,n+=12);var s=Math.floor(a/100),c=2-s+Math.floor(s/4),p=Math.floor(365.25*a),u=Math.floor(30.6001*(n+1)),d=c+p+u-730550.5+r+(i+o/60+l/3600)/24,f=d/36525,h=280.46061837+360.98564736629*d+387933e-9*f*f-f*f*f/3871e4+e;if(h>0)for(;h>360;)h-=360;else for(;0>h;)h+=360;return h}function r(t,a){return e(t,K[a])}function i(t,e){if("equatorial"===e)return t;for(var a=K[e],n=t.features,r=0;r<n.length;r++)n[r].geometry.coordinates=l(n[r],a);return t}function o(t){var e=[];for(var a in t)if(v(t,a)&&-1!==O.planets.which.indexOf(a)){var n=ht().id(a).elements(t[a].elements[0]);"ter"===a?_.origin=n:e.push(n)}return e}function l(t,a){var n=[];switch(t.geometry.type){case"Point":n=e(t.geometry.coordinates,a);break;case"LineString":n.push(u(t.geometry.coordinates,a));break;case"MultiLineString":n=d(t.geometry.coordinates,a);break;case"Polygon":n.push(u(t.geometry.coordinates[0],a));break;case"MultiPolygon":n.push(d(t.geometry.coordinates[0],a))}return n}function s(t,e){var a=[];if(!e)return[];b(e)||(e=[e]);for(var n=0;n<e.length;n++)switch(e[n]){case"center":a=a.concat("lat"===t?p(t,O.center[0],"N"):p(t,O.center[1],"S"));break;case"outline":"lon"===t?(a=a.concat(p(t,O.center[1]-89.99,"S")),a=a.concat(p(t,O.center[1]+89.99),"N")):(a=a.concat(p(t,O.center[0]-179.99,"E")),a=a.concat(p(t,O.center[0]+179.99,"W")));break;default:if(y(e[n])){a=a.concat("lat"===t?p(t,e[n],"N"):p(t,e[n],"S"));break}}return c(a)}function c(t){for(var e=[],a=0;a<t.length;a++){var n={type:"Feature",id:a,properties:{},geometry:{type:"Point"}};n.properties.value=t[a].value,n.properties.orientation=t[a].orientation,n.geometry.coordinates=t[a].coordinates,e.push(n)}return e}function p(t,e,a){var n,r,i,o,l,s=t,c=[],p=e;"equatorial"===O.transform&&"lon"===s&&(s="ra"),"ra"===s?(n=0,r=23,i=1):"lon"===s?(n=0,r=350,i=10):(n=-80,r=80,i=10);for(var u=n;r>=u;u+=i){var d=a;"lat"===s?(l=[p,u],o=u.toString()+"°",d+=0>u?"S":"N"):"ra"===s?(l=[15*u,p],o=u.toString()+"ʰ"):(l=[u,p],o=u.toString()+"°"),c.push({coordinates:l,value:o,orientation:d})}return c}function u(t,a){for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],a));return n}function d(t,e){for(var a=[],n=0;n<t.length;n++)a.push(u(t[n],e));return a}function f(t){return document.getElementById(t)}function h(t){return t+"px"}function m(t,e){return Math.round(Math.pow(10,e)*t)/Math.pow(10,e)}function g(t){return 10>t?"0"+t:t}function v(t,e){return null!==t&&hasOwnProperty.call(t,e)}function y(t){return!isNaN(parseFloat(t))&&isFinite(t)}function b(t){return"[object Array]"===Object.prototype.toString.call(t)}function M(t){var e=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,a+=t.offsetTop;while(null!==(t=t.offsetParent));return[e,a]}function w(t,e){for(;t.parentNode;){if(t.id===e)return!0;t=t.parentNode}return!1}function x(t,e,a){var n=e.valueOf()-t.valueOf(),r=a||"d";switch(r){case"y":case"yr":n/=31556926080;break;case"m":case"mo":n/=26298e5;break;case"d":case"dy":n/=864e5;break;case"h":case"hr":n/=36e5;break;case"n":case"mn":n/=6e4;break;case"s":case"sec":n/=1e3;break;case"ms":}return Math.floor(n)}function k(t){if(t){var e=t.split(".");if(!(e.length<1)&&(e=e[0].split("-"),e[0]=e[0].replace(/\D/g,""),e[0]))return e[1]=e[1]?e[1].replace(/\D/g,""):"1",e[2]=e[2]?e[2].replace(/\D/g,""):"1",new Date(Date.UTC(e[0],e[1]-1,e[2]))}}function z(t,e){return t=(t*Z+J)%J,e=(e*Z+J)%J,Math.abs(t-e)>Math.PI&&(t>e?t-=J:e>t&&(e-=J)),d3.interpolateNumber(t/Z,e/Z)}function q(t){function e(){var t=this,e=t.value;j(t)!==!1&&(s.width=e,_.resize({width:e}))}function a(){var t=this,e=t.value,a=A(e,s.transform);null!==a&&(s.center[0]=a),s.transform=e,_.reload({transform:e})}function n(){var t=this;t&&(s.projection=t.value,_.reproject(s))}function r(){j(this)!==!1&&i()!==!1&&_.rotate(s)}function i(){var t=f("centerx"),e=f("centery"),a=f("centerz");if(t&&e){if("equatorial"!==s.transform)s.center[0]=parseFloat(t.value);else{var n=parseFloat(t.value);s.center[0]=n>12?15*n-360:15*n}s.center[1]=parseFloat(e.value);var r=parseFloat(a.value);return s.center[2]=isNaN(r)?0:r,""!==t.value&&""!==e.value}}function o(){var t,e=this;switch(e.type){case"checkbox":t=e.checked,I(e);break;case"number":if(j(e)===!1)return;t=parseFloat(e.value);break;case"color":if(S(e)===!1)return;t=e.value;break;case"text":if(-1===e.id.search(/fill$/))return;if(S(e)===!1)return;t=e.value}null!==t&&(l(e.id,t),i(),_.apply(s))}function l(t,e){var a=t.split("-");switch(a.length){case 1:s[a[0]]=e;break;case 2:s[a[0]][a[1]]=e;break;case 3:s[a[0]][a[1]][a[2]]=e;break;default:return}}var s=tt.set(t),c=_.projections(),p=_.eulerAngles(),u=d3.select("#celestial-form").append("div").attr("class","ctrl"),d=u.append("form").attr("id","params").attr("name","params").attr("method","get").attr("action","#"),h=d.append("div").attr("class","col");h.append("label").attr("title","Map width in pixel, 0 indicates full width").attr("for","width").html("Width "),h.append("input").attr("type","number").attr("maxlength","4").attr("max","20000").attr("min","0").attr("title","Map width").attr("id","width").attr("value",s.width).on("change",e),h.append("span").html("px"),h.append("label").attr("title","Map projection, (hemi) indicates hemispherical projection").attr("for","projection").html("Projection");var m=h.append("select").attr("id","projection").on("change",n),g=0,v=Object.keys(c).map(function(t,e){var a=c[t].clip&&c[t].clip===!0?c[t].n+" (hemi)":c[t].n;return t===s.projection&&(g=e),{o:t,n:a}});m.selectAll("option").data(v).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),m.property("selectedIndex",g),g=0,h.append("label").attr("title","Coordinate space in which the map is displayed").attr("for","transform").html("Coordinates"),m=h.append("select").attr("id","transform").on("change",a),v=Object.keys(p).map(function(t,e){return t===s.transform&&(g=e),{o:t,n:t.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})}}),m.selectAll("option").data(v).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),m.property("selectedIndex",g),h.append("br"),h.append("label").attr("title","Center coordinates long/lat in selected coordinate space").attr("for","centerx").html("Center"),h.append("input").attr("type","number").attr("id","centerx").attr("list","centerx-list").attr("title","Center right ascension/longitude").attr("max","24").attr("min","0").attr("step","0.1").on("change",r),h.append("span").attr("id","cxunit").html("h"),h.append("input").attr("type","number").attr("id","centery").attr("title","Center declination/latitude").attr("max","90").attr("min","-90").attr("step","0.1").on("change",r),h.append("span").html("°"),h.append("label").attr("title","Orientation").attr("for","centerz").html("Orientation"),h.append("input").attr("type","number").attr("id","centerz").attr("title","Center orientation").attr("max","180").attr("min","-180").attr("step","0.1").on("change",r),h.append("span").html("°"),h.append("label").attr("for","orientationfixed").html("Fixed"),h.append("input").attr("type","checkbox").attr("id","orientationfixed").property("checked",s.orientationfixed).on("change",o),s.fullwidth&&h.append("input").attr("type","button").attr("id","fullwidth").attr("value","◄ Full Width ►").on("click",function(){return f("sidebar-wrapper").style.display="none",f("outer-wrapper").style.width="100%",f("main-wrapper").style.width="100%",this.style.display="none",_.display(s),!1}),E(s.center,s.transform),h=d.append("div").attr("class","col"),h.append("label").attr("class","header").attr("for","stars-show").html("Stars"),h.append("input").attr("type","checkbox").attr("id","stars-show").property("checked",s.stars.show).on("change",o),h.append("label").attr("for","stars-limit").html("down to magnitude"),h.append("input").attr("type","number").attr("id","stars-limit").attr("title","Star display limit (magnitude)").attr("value",s.stars.limit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",o),h.append("label").attr("for","stars-colors").html("with spectral colors"),h.append("input").attr("type","checkbox").attr("id","stars-colors").property("checked",s.stars.colors).on("change",o),h.append("label").attr("for","stars-color").html("or default color "),h.append("input").attr("type","color").attr("autocomplete","off").attr("id","stars-style-fill").attr("title","Star color").property("value",s.stars.style.fill).on("change",o),h.append("br"),h.append("label").attr("for","stars-names").html("Show designations"),h.append("input").attr("type","checkbox").attr("id","stars-names").property("checked",s.stars.names).on("change",o),h.append("label").attr("for","stars-namelimit").html("down to mag"),h.append("input").attr("type","number").attr("id","stars-namelimit").attr("title","Star designaton display limit (magnitude)").attr("value",s.stars.namelimit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",o),h.append("label").attr("for","stars-desig").attr("title","include HD/HIP designations").html("all"),h.append("input").attr("type","checkbox").attr("id","stars-desig").property("checked",s.stars.desig).on("change",o),h.append("label").attr("for","stars-proper").html("proper names"),h.append("input").attr("type","checkbox").attr("id","stars-proper").property("checked",s.stars.proper).on("change",o),h.append("label").attr("for","stars-propernamelimit").html("down to mag"),h.append("input").attr("type","number").attr("id","stars-propernamelimit").attr("title","Star name display limit (magnitude)").attr("value",s.stars.propernamelimit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",o),h.append("br"),h.append("label").attr("for","stars-size").html("Stellar disk size: base"),h.append("input").attr("type","number").attr("id","stars-size").attr("title","Size of the displayed star disk; base").attr("value",s.stars.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",o),h.append("label").attr("for","stars-exponent").html(" * e ^ (exponent"),h.append("input").attr("type","number").attr("id","stars-exponent").attr("title","Size of the displayed star disk; exponent").attr("value",s.stars.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",o),h.append("span").text(" * (magnitude + 2))  [* adaptation]"),I(f("stars-show")),h=d.append("div").attr("class","col"),h.append("label").attr("class","header").attr("title","Deep Space Objects").attr("for","dsos-show").html("DSOs"),h.append("input").attr("type","checkbox").attr("id","dsos-show").property("checked",s.dsos.show).on("change",o),h.append("label").attr("for","dsos-limit").html("down to mag"),h.append("input").attr("type","number").attr("id","dsos-limit").attr("title","DSO display limit (magnitude)").attr("value",s.dsos.limit).attr("max","6").attr("min","0").attr("step","0.1").on("change",o),h.append("label").attr("for","dsos-names").html("with names"),h.append("input").attr("type","checkbox").attr("id","dsos-names").property("checked",s.dsos.names).on("change",o),h.append("label").attr("for","dsos-desig").html("or designations"),h.append("input").attr("type","checkbox").attr("id","dsos-desig").property("checked",s.dsos.desig).on("change",o),h.append("label").attr("for","dsos-namelimit").html("down to mag"),h.append("input").attr("type","number").attr("id","dsos-namelimit").attr("title","DSO name display limit (magnitude)").attr("value",s.dsos.namelimit).attr("max","6").attr("min","0").attr("step","0.1").on("change",o),h.append("br"),h.append("label").attr("for","dsos-size").html("DSO symbol size: (base"),h.append("input").attr("type","number").attr("id","dsos-size").attr("title","Size of the displayed symbol: base").attr("value",s.dsos.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",o),h.append("label").attr("for","dsos-exponent").html(" * 2 [* adaptation] - magnitude) ^ exponent"),h.append("input").attr("type","number").attr("id","dsos-exponent").attr("title","Size of the displayed symbol; exponent").attr("value",s.dsos.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",o),I(f("dsos-show")),h=d.append("div").attr("class","col"),h.append("label").attr("class","header").html("Constellations"),h.append("label").attr("for","constellations-names").html("Show names"),h.append("input").attr("type","checkbox").attr("id","constellations-names").property("checked",s.constellations.names).on("change",o),h.append("label").attr("for","constellations-desig").html("abbreviated"),h.append("input").attr("type","checkbox").attr("id","constellations-desig").property("checked",s.constellations.desig).on("change",o),h.append("label").attr("for","constellations-lines").html("with lines"),h.append("input").attr("type","checkbox").attr("id","constellations-lines").property("checked",s.constellations.lines).on("change",o),h.append("label").attr("for","constellations-bounds").html("with boundaries"),h.append("input").attr("type","checkbox").attr("id","constellations-bounds").property("checked",s.constellations.bounds).on("change",o),I(f("constellations-names")),h=d.append("div").attr("class","col"),h.append("label").attr("class","header").html("Lines"),h.append("label").attr("title","Laitudet/longitude grid lines").attr("for","lines-graticule").html("Graticule"),h.append("input").attr("type","checkbox").attr("id","lines-graticule-show").property("checked",s.lines.graticule.show).on("change",o),h.append("label").attr("for","lines-equatorial").html("Equator"),h.append("input").attr("type","checkbox").attr("id","lines-equatorial-show").property("checked",s.lines.equatorial.show).on("change",o),h.append("label").attr("for","lines-ecliptic").html("Ecliptic"),h.append("input").attr("type","checkbox").attr("id","lines-ecliptic-show").property("checked",s.lines.ecliptic.show).on("change",o),h.append("label").attr("for","lines-galactic").html("Galactic plane"),h.append("input").attr("type","checkbox").attr("id","lines-galactic-show").property("checked",s.lines.galactic.show).on("change",o),h.append("label").attr("for","lines-supergalactic").html("Supergalactic plane"),h.append("input").attr("type","checkbox").attr("id","lines-supergalactic-show").property("checked",s.lines.supergalactic.show).on("change",o),h=d.append("div").attr("class","col"),h.append("label").attr("class","header").html("Other"),h.append("label").attr("for","mw-show").html("Milky Way"),h.append("input").attr("type","checkbox").attr("id","mw-show").property("checked",s.mw.show).on("change",o),h.append("label").attr("for","mw-style-fill").html(" color"),h.append("input").attr("type","color").attr("id","mw-style-fill").attr("title","Milky Way color").attr("value",s.mw.style.fill).on("change",o),h.append("label").attr("for","mw-style-opacity").html(" opacity"),h.append("input").attr("type","number").attr("id","mw-style-opacity").attr("title","Transparency of each Milky Way layer").attr("value",s.mw.style.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",o),h.append("br"),h.append("label").attr("for","background").html("Background color"),h.append("input").attr("type","color").attr("id","background-fill").attr("title","Background color").attr("value",s.background.fill).on("change",o),h.append("label").attr("title","Star/DSO sizes are increased with higher zoom-levels").attr("for","adaptable").html("Adaptable object sizes"),h.append("input").attr("type","checkbox").attr("id","adaptable").property("checked",s.adaptable).on("change",o),D(),A(s.transform)}function I(t){var e,a=t.id;switch(a){case"stars-show":e=!f(a).checked;for(var n=0;n<it[a].length;n++)P(it[a][n],e);case"stars-names":for(e=!f("stars-names").checked||!f("stars-show").checked,n=0;n<it["stars-names"].length;n++)P(it["stars-names"][n],e);case"stars-proper":for(e=!f("stars-names").checked||!f("stars-show").checked||!f("stars-proper").checked,n=0;n<it["stars-proper"].length;n++)P(it["stars-proper"][n],e);break;case"dsos-show":for(e=!f(a).checked,n=0;n<it[a].length;n++)P(it[a][n],e);case"dsos-names":for(e=!f("dsos-names").checked||!f("dsos-show").checked,n=0;n<it["dsos-names"].length;n++)P(it["dsos-names"][n],e);break;case"constellations-show":for(e=!f(a).checked,n=0;n<it[a].length;n++)P(it[a][n],e);break;case"mw-show":for(e=!f(a).checked,n=0;n<it[a].length;n++)P(it[a][n],e)}}function P(t,e){var a=f(t);a.disabled=e,a.previousSibling.style.color=e?"#999":"#000"}function T(t,e){var a=M(t);d3.select("#error").html(e).style({top:h(a[1]+t.offsetHeight+1),left:h(a[0]),opacity:1}),t.focus()}function j(t){var e,a="hr"===t.id||"min"===t.id||"sec"===t.id?1:0;if(t.validity){if(e=t.validity,e.typeMismatch||e.badInput)return T(t,t.title+": check field value"),!1;if(e.rangeOverflow||e.rangeUnderflow)return T(t,t.title+" must be between "+(parseInt(t.min)+a)+" and "+(parseInt(t.max)-a)),!1}else{if(e=t.value,!y(e))return T(t,t.title+": check field value"),!1;if(e=parseFloat(e),e<t.min||e>t.max)return T(t,t.title+" must be between "+(t.min+a)+" and "+(+t.max-a)),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function S(t){if(t.validity){if(e=t.validity,e.typeMismatch||e.badInput)return T(t,t.title+": check field value"),!1;if(-1===t.value.search(/^#[0-9A-F]{6}$/i))return T(t,t.title+": not a color value"),!1}else{var e=t.value;if(""===e)return!0;if(-1===e.search(/^#[0-9A-F]{6}$/i))return T(t,t.title+": not a color value"),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function A(t,e){var a=f("centerx");return a?(e&&("equatorial"===t&&"equatorial"!==e?(a.value=(a.value/15).toFixed(1),a.value<0&&(a.value+=24)):"equatorial"!==t&&"equatorial"===e&&(a.value=(15*a.value).toFixed(1),a.value>180&&(a.value-=360))),"equatorial"===t?(a.min="0",a.max="24",f("cxunit").innerHTML="h"):(a.min="-180",a.max="180",f("cxunit").innerHTML="°"),a.value):null}function E(t,e){var a=f("centerx"),n=f("centery"),r=f("centerz");a&&n&&(null===t&&(t=[0,0,0]),t.length<=2&&(t[2]=0),a.value="equatorial"!==e?t[0].toFixed(1):t[0]<0?(t[0]/15+24).toFixed(1):(t[0]/15).toFixed(1),n.value=t[1].toFixed(1),r.value=null!==t[2]?t[2].toFixed(1):0)}function D(){var t,e,a,n=/\d+(\.\d+)?/g,r={s:6,d:6},i=_.settings();return a=i.dsos.data,t=a.match(n),null!==t&&(r.d=parseFloat(t[t.length-1])),6!=r.d&&(f("dsos-limit").max=r.d,f("dsos-namelimit").max=r.d),e=i.stars.data,t=e.match(n),null!==t&&(r.s=parseFloat(t[t.length-1])),6!=r.s&&(f("stars-limit").max=r.s,f("stars-namelimit").max=r.s),r}function F(t){function e(){lt.setTime(Date.now()),f("datetime").value=r(lt,c),i()}function a(){navigator.geolocation.getCurrentPosition(function(t){l=[t.coords.latitude.toFixed(4),t.coords.longitude.toFixed(4)],d3.select("#lat").attr("value",l[0]),d3.select("#lon").attr("value",l[1]),i()})}function n(){p.show(lt)}function r(t,e){var a;if(e&&"0"!==e){var n=Math.floor(Math.abs(e)/60),r=Math.abs(e)-60*n,i=0>e?" +":" −";a=i+g(n)+g(r)}else a=" ±0000";return s(t)+a}function i(){var e=f("lon").value,a=f("lat").value;lt=s.parse(f("datetime").value.slice(0,-6));var n=lt.getTimezoneOffset(),r=new Date(lt.valueOf()+6e4*(c-n));t.horizon.show=!!f("horizon-show").checked,t.planets.show=!!f("planets-show").checked,""!==e&&""!==a&&(l=[parseFloat(a),parseFloat(e)],ot=_.getPoint(X.inverse(r,[90,0],l),t.transform),ot[2]=0,_.rotate({center:ot,horizon:t.horizon}))}var o=d3.select("#celestial-form").append("div").attr("id","loc"),l=[0,0],s=d3.time.format("%Y-%m-%d %H:%M:%S"),c=lt.getTimezoneOffset(),p=new mt(function(t,e){f("datetime").value=r(t,e),c=e,i()}),u=o.append("div").attr("class","col");u.append("label").attr("title","Location coordinates long/lat").attr("for","lat").html("Location"),u.append("input").attr("type","number").attr("id","lat").attr("title","Latitude").attr("placeholder","Latitude").attr("max","90").attr("min","-90").attr("step","0.0001").attr("value",l[0]).on("change",function(){j(this)===!0&&i()}),u.append("span").html("°"),u.append("input").attr("type","number").attr("id","lon").attr("title","Longitude").attr("placeholder","Longitude").attr("max","180").attr("min","-180").attr("step","0.0001").attr("value",l[1]).on("change",function(){j(this)===!0&&i()}),u.append("span").html("°"),"geolocation"in navigator&&u.append("input").attr("type","button").attr("value","Here").attr("id","here").on("click",a),u.append("label").attr("title","Local date/time").attr("for","datetime").html(" Date/time"),u.append("input").attr("type","text").attr("id","datetime").attr("title","Date and time").attr("value",r(lt,c)).on("click",n,!0).on("input",function(){this.value=r(lt,c),p.isVisible()||n()}),u.append("div").attr("id","datepick").on("click",n),u.append("input").attr("type","button").attr("value","Now").attr("id","now").on("click",e),u.append("br"),u.append("label").attr("title","Show horizon marker").attr("for","horizon-show").html(" Horizon marker"),u.append("input").attr("type","checkbox").attr("id","horizon-show").property("checked",t.horizon.show).on("change",i),u.append("label").attr("title"," Show planets").attr("for","planets-show").html(" Planets"),u.append("input").attr("type","checkbox").attr("id","planets-show").property("checked",t.planets.show).on("change",i),d3.select(document).on("mousedown",function(){!w(d3.event.target,"celestial-date")&&p.isVisible()&&p.hide()}),setTimeout(i,1e3)}function C(t){var e=f("horizon-show");e&&(e.style.display=t===!0?"none":"inline-block",e.previousSibling.style.display=e.style.display)}var O,L,H,N,U,_={version:"0.6.0",container:null,data:[]},W=.035,G=1.4,V=2e3,B=2500,Y=1500;_.display=function(a){function n(){for(var t in O.lines)v(O.lines,t)&&("graticule"===t?(ht.append("path").datum(Ot).attr("class","graticule"),v(O.lines.graticule,"lon")&&O.lines.graticule.lon.pos.length>0&&ht.selectAll(".gridvalues_lon").data(s("lon",O.lines.graticule.lon.pos)).enter().append("path").attr("class","graticule_lon"),v(O.lines.graticule,"lat")&&O.lines.graticule.lat.pos.length>0&&ht.selectAll(".gridvalues_lat").data(s("lat",O.lines.graticule.lat.pos)).enter().append("path").attr("class","graticule_lat")):ht.append("path").datum(d3.geo.circle().angle([90]).origin(e($[t],K[kt]))).attr("class",t));d3.json(Dt+"mw.json",function(t,e){if(t)return window.alert("Your Browser doesn't support local file loading or the file doesn't exist. See readme.md"),console.warn(t);var a=i(e,kt);ht.selectAll(".mway").data(a.features).enter().append("path").attr("class","mw"),d()}),d3.json(Dt+"constellations.json",function(t,e){if(t)return console.warn(t);var a=i(e,kt);ht.selectAll(".constnames").data(a.features).enter().append("text").attr("class","constname"),d()}),d3.json(Dt+"constellations.bounds.json",function(t,e){if(t)return console.warn(t);var a=i(e,kt);ht.selectAll(".bounds").data(a.features).enter().append("path").attr("class","boundaryline"),d()}),d3.json(Dt+"constellations.lines.json",function(t,e){if(t)return console.warn(t);var a=i(e,kt);ht.selectAll(".lines").data(a.features).enter().append("path").attr("class","constline"),d()}),d3.json(Dt+O.stars.data,function(t,e){if(t)return console.warn(t);var a=i(e,kt);ht.selectAll(".stars").data(a.features).enter().append("path").attr("class","star"),d()}),d3.json(Dt+O.dsos.data,function(t,e){if(t)return console.warn(t);var a=i(e,kt);ht.selectAll(".dsos").data(a.features).enter().append("path").attr("class","dso"),d()}),d3.json(Dt+"planets.json",function(t,e){if(t)return console.warn(t);var a=o(e,kt);ht.selectAll(".planets").data(a).enter().append("path").attr("class","planet"),d()}),_.data.length>0&&_.data.forEach(function(t){v(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this)}function r(t){if(t&&1!==t){var e=L.scale(),a=e*t,n=H.scaleExtent(),r=Y*Math.sqrt(Math.abs(1-t));a<n[0]&&(a=n[0]),a>n[1]&&(a=n[1]);var i=d3.interpolateNumber(e,a);return d3.select({}).transition().duration(r).tween("scale",function(){return function(t){var e=i(t);L.scale(e),d()}}).transition().duration(0).tween("scale",function(){H.scale(a),d()}),r}}function l(t){O=O.set(t),d()}function c(t){var e,a,n,r=O.center,i=L.rotate(),o=L.scale(),l=V,s=!1,c=O.orientationfixed;m(i[1],1)===-m(t.center[1],1)&&(s=!0),O=O.set(t);var p=m(d3.geo.distance(r,O.center),2),u=d3.geo.distance([r[2],0],[O.center[2],0]);return W>p&&W>u?(Et=ct(O.center),L.rotate(Et),d()):(a=o>It*G?d3.interpolateNumber(o,It):function(){return o},n=0===u?function(){return i[2]}:z(r[2],O.center[2]),p>3.14&&(O.center[0]-=.01),O.orientationfixed=!1,e=0===p?function(){return O.center}:d3.geo.interpolate(r,O.center),l=0!==p?l*p:l*u,d3.select({}).transition().duration(l).tween("center",function(){return function(t){var r=ct(e(t));r[2]=n(t);var o=a(.5>t?t:1-t);s&&(r[1]=i[1]),L.scale(o),L.rotate(r),d()}}).transition().duration(0).tween("center",function(){O.orientationfixed=c,Et=ct(O.center),L.rotate(Et),d()})),l}function p(t){wt=lt(),(O.width!==wt||t)&&(qt=wt/zt,It=xt.scale*wt/1024,Ft.attr("width",wt).attr("height",qt),H.scaleExtent([It,5*It]).scale(It),L.translate([wt/2,qt/2]).scale(It),yt&&(yt.style.height=h(qt)),d())}function u(e){var a=st(e.projection);if(a){var n=L.rotate(),i=L.center(),o=L.scale(),l=H.scaleExtent(),s=_.projection(O.projection).center(i).translate([wt/2,qt/2]).scale([l[0]]),c=B,p=0,f=d3.interpolateNumber(zt,a.ratio);xt.clip!=a.clip&&(c=0);var m=_.projection(e.projection).center(i).translate([wt/2,wt/a.ratio/2]).scale([a.scale*wt/1024]),g=O.adaptable;return o>l[0]?(p=r(.1),setTimeout(u,p,e),p+c):(C(a.clip),L=t(s,m),O.adaptable=!1,d3.select({}).transition().duration(c).tween("projection",function(){return function(t){L.alpha(t).rotate(n),N.projection(L),I(a.clip),zt=f(t),qt=wt/zt,Ft.attr("width",wt).attr("height",qt),yt&&(yt.style.height=h(qt)),d()}}).transition().duration(0).tween("projection",function(){xt=a,zt=xt.ratio,qt=wt/xt.ratio,It=xt.scale*wt/1024,Ft.attr("width",wt).attr("height",qt),yt&&(yt.style.height=h(qt)),O.projection=e.projection,L=_.projection(e.projection).rotate(n).translate([wt/2,qt/2]).scale(It),N.projection(L),I(xt.clip),H.projection(L).scaleExtent([It,5*It]).scale(It),O.adaptable=g,d()}),c)}}function d(){var t=L.rotate();O.adaptable&&(At=Math.sqrt(L.scale()/It)),At||(At=1),Pt=O.stars.size,jt=O.stars.exponent,Tt=O.dsos.size||Pt,St=O.dsos.exponent,O.orientationfixed&&(t[2]=O.center[2],L.rotate(t)),O.center=[-t[0],-t[1],t[2]],E(O.center,O.transform),ot(),g(),O.mw.show&&ht.selectAll(".mw").each(function(t){M(O.mw.style),N(t),Ct.fill()});for(var e in O.lines)v(O.lines,e)&&O.lines[e].show===!0&&(M(O.lines[e]),ht.selectAll("."+e).attr("d",N),Ct.stroke());if(v(O.lines.graticule,"lon")&&(w(O.lines.graticule.lon),ht.selectAll(".graticule_lon").each(function(t){if(y(t.geometry.coordinates)){var e=L(t.geometry.coordinates);it(e,t.properties.orientation),Ct.fillText(t.properties.value,e[0],e[1])}})),v(O.lines.graticule,"lat")&&(w(O.lines.graticule.lat),ht.selectAll(".graticule_lat").each(function(t){if(y(t.geometry.coordinates)){var e=L(t.geometry.coordinates);it(e,t.properties.orientation),Ct.fillText(t.properties.value,e[0],e[1])}})),g(!0),O.constellations.show&&(O.constellations.bounds&&(ht.selectAll(".boundaryline").each(function(t){M(O.constellations.boundstyle),N(t),Ct.stroke()}),g(!0)),O.constellations.names&&(w(O.constellations.namestyle),ht.selectAll(".constname").each(function(t){if(y(t.geometry.coordinates)){x(t.properties.rank,O.constellations.namestyle.font);var e=L(t.geometry.coordinates);Ct.fillText(rt(t),e[0],e[1])}})),O.constellations.lines&&ht.selectAll(".constline").each(function(t){M(O.constellations.linestyle),N(t),Ct.stroke()})),O.stars.show&&(M(O.stars.style),ht.selectAll(".star").each(function(t){if(y(t.geometry.coordinates)&&t.properties.mag<=O.stars.limit){var e=L(t.geometry.coordinates),a=Z(t);Ct.fillStyle=X(t),Ct.beginPath(),Ct.arc(e[0],e[1],a,0,2*Math.PI),Ct.closePath(),Ct.fill(),O.stars.names&&t.properties.mag<=O.stars.namelimit*At&&(w(O.stars.namestyle),Ct.fillText(D(t),e[0]+a,e[1])),O.stars.proper&&t.properties.mag<=O.stars.propernamelimit*At&&(w(O.stars.propernamestyle),Ct.fillText(J(t),e[0]-a,e[1]))}})),O.dsos.show&&ht.selectAll(".dso").each(function(t){if(y(t.geometry.coordinates)&&P(t.properties,O.dsos.limit)){var e=L(t.geometry.coordinates),a=t.properties.type;M(O.dsos.symbols[a]);var n=T(t,e);v(O.dsos.symbols[a],"stroke")?Ct.stroke():Ct.fill(),O.dsos.names&&P(t.properties,O.dsos.namelimit)&&(w(O.dsos.namestyle),Ct.fillStyle=O.dsos.symbols[a].fill,Ct.fillText(A(t),e[0]+n,e[1]-n))}}),O.location&&O.planets.show&&_.origin){var a=_.date(),n=_.origin(a).cartesian();ht.selectAll(".planet").each(function(t){var e=t(a).equatorial(n);if(y(e.pos)){var r=L(e.pos);w(O.planets.style),Ct.fillText(t.symbol(),r[0],r[1])}})}_.data.length>0&&_.data.forEach(function(t){t.redraw()}),O.location&&O.horizon.show&&!xt.clip&&(U.origin(_.nadir()),M(O.horizon),ht.selectAll(".horizon").datum(U).attr("d",N),Ct.fill(),O.horizon.stroke&&Ct.stroke()),O.controls&&k(L.scale())}function g(t){var e=L.rotate();L.rotate([0,0]),M(O.background),ht.selectAll(".outline").attr("d",N),t?Ct.stroke():Ct.fill(),L.rotate(e)}function y(t){return xt.clip&&d3.geo.distance(O.center,t)>Q?0:1}function M(t){Ct.fillStyle=t.fill||null,Ct.strokeStyle=t.stroke||null,Ct.lineWidth=t.width||null,Ct.globalAlpha=t.opacity||1,Ct.font=t.font||null,Ct.setLineDash(v(t,"dash")?t.dash:[]),Ct.beginPath()}function w(t){Ct.fillStyle=t.fill,Ct.textAlign=t.align||"left",Ct.textBaseline=t.baseline||"bottom",Ct.globalAlpha=t.opacity||1,Ct.font=t.font}function x(t,e){Ct.font=b(e)?1===e.length?e[0]:t>e.length?e[e.length-1]:e[t-1]:e}function k(t){var e=f("celestial-zoomin"),a=f("celestial-zoomout");e&&a&&(e.disabled=t>=4.99*It,a.disabled=It>=t)}function I(t){t?(L.clipAngle(90),ht.selectAll(".outline").remove(),ht.append("path").datum(d3.geo.circle().angle([90])).attr("class","outline")):(L.clipAngle(null),ht.selectAll(".outline").remove(),ht.append("path").datum(Ot.outline).attr("class","outline"))}function P(t,e){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>e||999!==t.mag&&t.mag<=e}function T(t,e){var a=t.properties,n=S(a)||9,r=j(a.type);return nt.symbol().type(r).size(n).position(e)(Ct),Math.sqrt(n)/2}function j(t){return t&&v(O.dsos.symbols,t)?O.dsos.symbols[t].shape:"circle"}function S(t){return t.mag&&999!=t.mag?Math.pow(2*Tt*At-t.mag,St):Math.pow(parseInt(t.dim)*Tt*At/7,.5)}function A(t){var e=t.properties;if(""!==e.name)return O.dsos.desig&&e.desig?e.desig:e.name}function D(t){var e=t.properties.desig;return O.stars.desig?e:e.replace(/^(HD|HIP|V\d{3}).+/,"")}function J(t){var e=t.properties.name;return e}function Z(t){var e=t.properties.mag;if(null===e)return.1;var a=Pt*At*Math.exp(jt*(e+2));return Math.max(a,.1)}function X(t){var e=t.properties.bv;return!O.stars.colors||isNaN(e)?O.stars.style.fill:et(e)}function rt(t){return O.constellations.desig?t.properties.desig:t.properties[O.lang]}function it(t,e){for(var a=e.split(""),n="center",r="middle",i=a.length-1;i>=0;i--)switch(a[i]){
case"N":r="bottom";break;case"S":r="top";break;case"E":n="left",t[0]+=2;break;case"W":n="right",t[0]-=2}return Ct.textAlign=n,Ct.textBaseline=r,t}function ot(){Ct.clearRect(0,0,wt+Mt[0],qt+Mt[1])}function lt(){return O.width&&O.width>0?O.width:yt?yt.clientWidth-Mt[0]:window.innerWidth-2*Mt[0]}function st(t){if(v(at,t)){var e=at[t];return v(e,"ratio")||(e.ratio=2),e}}function ct(t){if(null===t)return[0,0,0];var e=R.equatorial;return t[2]||(t[2]=0),[e[0]-t[0],e[1]-t[1],e[2]+t[2]]}function pt(){if(mt&&!(mt.length<1)){var t,e=mt[gt];switch(e.param){case"projection":t=u({projection:e.value});break;case"center":t=c({center:e.value});break;case"zoom":t=r(e.value)}e.callback&&setTimeout(e.callback,t),gt++,vt===!0&&gt===mt.length&&(gt=0),t=0===e.duration||e.duration<t?t:e.duration,gt<mt.length&&(ft=setTimeout(pt,t))}}function ut(){clearTimeout(ft)}var dt,ft,ht=_.container,mt=[],gt=0,vt=!1;O=tt.set(a),O.stars.size=O.stars.size||7,O.stars.exponent=O.stars.exponent||-.28,O.center=O.center||[0,0],O.lang&&-1!==O.lang.search(/^de|es$/)||(O.lang="name");var yt=f(O.container);if(yt){dt="#"+O.container;var bt=window.getComputedStyle(yt,null);parseInt(bt.width)||O.width||(yt.style.width=h(yt.parentNode.clientWidth))}else dt="body",yt=null;var Mt=[16,16],wt=lt(),xt=st(O.projection);if(O.lines.graticule.lat&&"outline"===O.lines.graticule.lat.pos[0]&&(xt.scale-=2),xt){var kt=O.transform||"equatorial",zt=xt.ratio,qt=wt/zt,It=xt.scale*wt/1024,Pt=O.stars.size,Tt=O.dsos.size||Pt,jt=O.stars.exponent,St=O.dsos.exponent||jt,At=1,Et=ct(O.center),Dt=O.datapath||"";Dt=Dt.replace(/([^\/]$)/,"$1/"),"body"!=dt&&(f(O.container).style.height=h(qt)),L=_.projection(O.projection).rotate(Et).translate([wt/2,qt/2]).scale(It),H=d3.geo.zoom().projection(L).center([wt/2,qt/2]).scaleExtent([It,5*It]).on("zoom.redraw",d);var Ft=d3.selectAll("canvas");0===Ft[0].length&&(Ft=d3.select(dt).append("canvas")),Ft.attr("width",wt).attr("height",qt);var Ct=Ft.node().getContext("2d"),Ot=d3.geo.graticule().minorStep([15,10]);N=d3.geo.path().projection(L).context(Ct),ht?ht.selectAll("*").remove():ht=d3.select(dt).append("container"),O.interactive?Ft.call(H):Ft.attr("style","cursor: default!important"),I(xt.clip),d3.select(window).on("resize",p),O.controls===!0&&null===f("celestial-zoomin")&&(d3.select(dt).append("input").attr("type","button").attr("id","celestial-zoomin").attr("value","+").on("click",function(){r(1.111)}),d3.select(dt).append("input").attr("type","button").attr("id","celestial-zoomout").attr("value","−").on("click",function(){r(.9)})),O.location===!0&&(U=d3.geo.circle().angle([90]),ht.append("path").datum(U).attr("class","horizon"),null===f("loc")?F(O):c({center:_.zenith()}),C(xt.clip)),O.form===!0&&null===f("params")&&q(O),null===f("error")&&d3.select("body").append("div").attr("id","error"),this.container=ht,this.clip=y,this.map=N,this.mapProjection=L,this.context=Ct,this.setStyle=M,this.setTextStyle=w,this.setConstStyle=x,this.redraw=d,this.resize=function(t){t&&v(t,"width")&&(O.width=t.width),p(!0)},this.reload=function(t){t&&v(t,"transform")&&(kt=O.transform=t.transform,Ot.minorStep("equatorial"===kt?[15,10]:[10,10]),ht.selectAll("*").remove(),I(),ht.append("path").datum(U).attr("class","horizon"),n())},this.apply=function(t){l(t)},this.reproject=function(t){return u(t)},this.rotate=function(t){return t?c(t):O.center},this.zoomBy=function(t){return t?r(t):L.scale()/It},this.color=function(t){return t&&v(O.dsos.symbols,t)?O.dsos.symbols[t].fill:"#000"},this.animate=function(t,e){t&&(mt=t,gt=0,vt=e?!0:!1,pt())},this.stop=function(t){ut(),t===!0&&(mt=[])},this.go=function(t){mt.length<1||(t&&t<mt.length&&(gt=t),pt())},n()}},_.projection=function(t){var e,a,n;if(!v(at,t))throw new Error("Projection not supported: "+t);return e=at[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,n=function(t,e){var n=a(-t,e);return n},n.invert=function(t,e){var n=a.invert(t,e);return n[0]*=-1,n},d3.geo.projection(n)};var R={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},$={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};_.eulerAngles=function(){return R},_.poles=function(){return $};var J=2*Math.PI,Q=Math.PI/2,Z=Math.PI/180,K={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*Z}))},add:function(t,e){return e&&t&&3===e.length&&!this.hasOwnProperty(t)?(this[t]=e.map(function(t){return t*Z}),this[t]):void 0}};K.init(),_.euler=function(){return K};var X=function(t,e,a){var r=n(t,a[1])-e[0];0>r&&(r+=360),r*=Z;var i=e[1]*Z,o=a[0]*Z,l=Math.asin(Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos(r)),s=Math.acos((Math.sin(i)-Math.sin(l)*Math.sin(o))/(Math.cos(l)*Math.cos(o)));return Math.sin(r)>0&&(s=2*Math.PI-s),[l/Z,s/Z,0]};X.inverse=function(t,e,a){var r=e[0]*Z,i=e[1]*Z,o=a[0]*Z,l=Math.asin(Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos(i)),s=((Math.sin(r)-Math.sin(l)*Math.sin(o))/(Math.cos(l)*Math.cos(o))).toFixed(6);s=Math.acos(s),s/=Z;var c=n(t,a[1])-s;return[c,l/Z,0]},_.horizontal=X,_.add=function(t){var e={};return v(t,"type")?"dso"!==t.type||v(t,"file")&&v(t,"callback")?"line"!==t.type||v(t,"callback")?(v(t,"file")&&(e.file=t.file),e.type=t.type,v(t,"callback")&&(e.callback=t.callback),v(t,"redraw")&&(e.redraw=t.redraw),void _.data.push(e)):console.log("Can't add line"):console.log("Can't add data file"):console.log("Missing type")},_.getData=i,_.getPoint=r;var tt={width:0,projection:"aitoff",transform:"equatorial",center:null,orientationfixed:!0,adaptable:!0,interactive:!0,form:!1,location:!1,fullwidth:!1,controls:!0,lang:"",container:"celestial-map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},names:!0,proper:!1,desig:!1,namestyle:{fill:"#ddddbb",font:"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},namelimit:2.5,propernamestyle:{fill:"#ddddbb",font:"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"right",baseline:"bottom"},propernamelimit:1.5,size:7,exponent:-.28,data:"stars.6.json"},dsos:{show:!0,limit:6,names:!0,desig:!0,namestyle:{fill:"#cccccc",font:"11px 'Lucida Sans Unicode', Helvetica, Arial, serif",align:"left",baseline:"top"},namelimit:4,size:null,exponent:1.4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ff9900",stroke:"#ff9900",width:2},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc"},sfr:{shape:"square",fill:"#cc00ff"},rn:{shape:"square",fill:"#0000ff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,desig:!0,namestyle:{fill:"#cccc99",align:"center",baseline:"middle",opacity:.8,font:["14px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif","12px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif","11px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"]},lines:!0,linestyle:{stroke:"#cccccc",width:1.5,opacity:.6},bounds:!1,boundstyle:{stroke:"#ccff00",width:1,opacity:.8,dash:[2,4]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8,lon:{pos:[""],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"},lat:{pos:[""],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"}},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},background:{fill:"#000000",opacity:1,stroke:"#000000",width:1.5},horizon:{show:!1,stroke:null,width:1,fill:"#000000",opacity:.5},planets:{show:!1,which:["mer","ven","ter","mar","jup","sat","ura","nep"],style:{fill:"#00ccff",font:"bold 17px 'Lucida Sans Unicode', Consolas, sans-serif",align:"center",baseline:"middle"},symbols:{sol:{symbol:"☉",fill:"#cccccc"},mer:{symbol:"☿",fill:"#cccccc"},ven:{symbol:"♀",fill:"#cccccc"},ter:{symbol:"⊕",fill:"#cccccc"},lun:{symbol:"●",fill:"#cccccc"},mar:{symbol:"♂",fill:"#cccccc"},cer:{symbol:"⚳",fill:"#cccccc"},ves:{symbol:"⚶",fill:"#cccccc"},jup:{symbol:"♃",fill:"#cccccc"},sat:{symbol:"♄",fill:"#cccccc"},ura:{symbol:"♅",fill:"#cccccc"},nep:{symbol:"♆",fill:"#cccccc"},plu:{symbol:"♇",fill:"#cccccc"},eri:{symbol:"⚪",fill:"#cccccc"}}},daylight:{show:!1,fill:"#fff",opacity:.4},set:function(t){var e,a,n={};if(!t)return this;for(e in this)if(v(this,e))if(v(t,e)&&null!==t[e])if(null===this[e]||this[e].constructor!=Object)n[e]=t[e];else{n[e]={};for(a in this[e])n[e][a]=v(t[e],a)?t[e][a]:this[e][a]}else n[e]=this[e];return n}};_.settings=function(){return tt};var et=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),at={airy:{n:"Airy’s Minimum Error",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker Dinomic",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus Star",arg:0,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs Eumorphic",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/5,scale:225,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig Retroazimuthal",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:"Craster Parabolic",arg:null,scale:160},cylindricalEqualArea:{n:"Cylindrical Equal Area",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:"Cylindrical Stereographic",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:"Eckert I",arg:null,scale:175},eckert2:{n:"Eckert II",arg:null,scale:175},eckert3:{n:"Eckert III",arg:null,scale:190},eckert4:{n:"Eckert IV",arg:null,scale:190},eckert5:{n:"Eckert V",arg:null,scale:182},eckert6:{n:"Eckert VI",arg:null,scale:182},eisenlohr:{n:"Eisenlohr",arg:null,scale:102},equirectangular:{n:"Equirectangular",arg:null,scale:165},fahey:{n:"Fahey",arg:null,scale:196,ratio:1.4},mtFlatPolarParabolic:{n:"Flat Polar Parabolic",arg:null,scale:175},mtFlatPolarQuartic:{n:"Flat Polar Quartic",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{n:"Flat Polar Sinusoidal",arg:null,scale:175,ratio:1.9},foucaut:{n:"Foucaut",arg:null,scale:142},ginzburg4:{n:"Ginzburg IV",arg:null,scale:180,ratio:1.7},ginzburg5:{n:"Ginzburg V",arg:null,scale:196,ratio:1.55},ginzburg6:{n:"Ginzburg VI",arg:null,scale:190,ratio:1.4},ginzburg8:{n:"Ginzburg VIII",arg:null,scale:205,ratio:1.3},ginzburg9:{n:"Ginzburg IX",arg:null,scale:190,ratio:1.4},homolosine:{n:"Goode Homolosine",arg:null,scale:160,ratio:2.2},hammer:{n:"Hammer",arg:2,scale:180},hatano:{n:"Hatano",arg:null,scale:186},healpix:{n:"HEALPix",arg:1,scale:320,ratio:1.2},hill:{n:"Hill Eucyclic",arg:2,scale:190,ratio:1.1},kavrayskiy7:{n:"Kavrayskiy VII",arg:null,scale:185,ratio:1.75},lagrange:{n:"Lagrange",arg:Math.PI/4,scale:88,ratio:1.6,clip:!1},larrivee:{n:"l'Arrivée",arg:null,scale:160,ratio:1.25},laskowski:{n:"Laskowski Tri-Optimal",arg:null,scale:165,ratio:1.7},loximuthal:{n:"Loximuthal",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:"Mercator",arg:null,scale:160,ratio:1.3},miller:{n:"Miller",arg:null,scale:160,ratio:1.5},mollweide:{n:"Mollweide",arg:null,scale:180},naturalEarth:{n:"Natural Earth",arg:null,scale:185,ratio:1.85},nellHammer:{n:"Nell Hammer",arg:null,scale:160,ratio:2.6},orthographic:{n:"Orthographic",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:"Patterson Cylindrical",arg:null,scale:160,ratio:1.75},polyconic:{n:"Polyconic",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:"Rectangular Polyconic",arg:0,scale:160,ratio:1.65},robinson:{n:"Robinson",arg:null,scale:160},sinusoidal:{n:"Sinusoidal",arg:null,scale:160,ratio:2},stereographic:{n:"Stereographic",arg:null,scale:500,ratio:1,clip:!0},times:{n:"Times",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:"Two-Point Equidistant",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:"van Der Grinten",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:"van Der Grinten II",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:"van Der Grinten III",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:"van Der Grinten IV",arg:null,scale:160,ratio:1.6},wagner4:{n:"Wagner IV",arg:null,scale:185},wagner6:{n:"Wagner VI",arg:null,scale:160},wagner7:{n:"Wagner VII",arg:null,scale:190,ratio:1.8},wiechel:{n:"Wiechel",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:"Winkel Tripel",arg:null,scale:196,ratio:1.7}};_.projections=function(){return at};var nt={};nt.symbol=function(){function t(t){i[a()](t)}var e,a=d3.functor("circle"),n=d3.functor(64),r=(d3.functor("#fff"),d3.functor("")),i=(d3.functor([2,2]),{circle:function(t){var a=Math.sqrt(n()),r=a/2;return t.arc(e[0],e[1],r,0,2*Math.PI),r},square:function(t){var a=Math.sqrt(n()),r=a/1.7;return t.moveTo(e[0]-r,e[1]-r),t.lineTo(e[0]+r,e[1]-r),t.lineTo(e[0]+r,e[1]+r),t.lineTo(e[0]-r,e[1]+r),t.closePath(),r},diamond:function(t){var a=Math.sqrt(n()),r=a/1.5;return t.moveTo(e[0],e[1]-r),t.lineTo(e[0]+r,e[1]),t.lineTo(e[0],e[1]+r),t.lineTo(e[0]-r,e[1]),t.closePath(),r},triangle:function(t){var a=Math.sqrt(n()),r=a/Math.sqrt(3);return t.moveTo(e[0],e[1]-r),t.lineTo(e[0]+r,e[1]+r),t.lineTo(e[0]-r,e[1]+r),t.closePath(),r},ellipse:function(t){var a=Math.sqrt(n()),r=a/2;return t.save(),t.translate(e[0],e[1]),t.scale(1.6,.8),t.beginPath(),t.arc(0,0,r,0,2*Math.PI),t.closePath(),t.restore(),r},marker:function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-r),t.lineTo(e[0],e[1]+r),t.moveTo(e[0]-r,e[1]),t.lineTo(e[0]+r,e[1]),t.closePath(),r},"cross-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.moveTo(e[0]-a,e[1]),t.lineTo(e[0]+a,e[1]),t.stroke(),t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r},"stroke-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.stroke(),t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r}});return t.type=function(e){return arguments.length?(a=d3.functor(e),t):a},t.size=function(e){return arguments.length?(n=d3.functor(e),t):n},t.text=function(e){return arguments.length?(r=d3.functor(e),t):r},t.position=function(a){return arguments.length?(e=a,t):void 0},t},_.Canvas=nt;var rt={sinh:function(t){return(Math.pow(Math.E,t)-Math.pow(Math.E,-t))/2},cosh:function(t){return(Math.pow(Math.E,t)+Math.pow(Math.E,-t))/2},tanh:function(t){return 2/(1+Math.exp(-2*t))-1},asinh:function(t){return Math.log(t+Math.sqrt(t*t+1))},acosh:function(t){return Math.log(t+Math.sqrt(t*t-1))},normalize0:function(t){return(t+3*Math.PI)%(2*Math.PI)-Math.PI},normalize:function(t){return(t+2*Math.PI)%(2*Math.PI)},cartesian:function(t){var e=t[0],a=Q-t[1],n=t[2];return{x:n*Math.sin(a)*Math.cos(e),y:n*Math.sin(a)*Math.sin(e),z:n*Math.cos(a)}},spherical:function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),a=Math.atan(t.y/t.x),n=Math.acos(t.z/e);return[a/Z,n/Z,e]}},it={"stars-show":["stars-limit","stars-colors","stars-style-fill","stars-names","stars-size","stars-exponent"],"stars-names":["stars-proper","stars-desig","stars-namelimit"],"stars-proper":["stars-propernamelimit"],"dsos-show":["dsos-limit","dsos-names","dsos-size","dsos-exponent"],"dsos-names":["dsos-desig","dsos-namelimit"],"mw-show":["mw-style-opacity","mw-style-fill"],"constellations-names":["constellations-desig"]},ot=[0,0],lt=new Date;_.date=function(){return lt},_.zenith=function(){return ot},_.nadir=function(){var t=-ot[1],e=ot[0]+180;return e>180&&(e-=360),[e,t-.001]};var st={sol:.0002959122082855911,mer:0x95955473dbc3,ven:0x89d9374048629,ter:0xa923c08a47948,lun:36599199229256,mar:319711652803400,cer:467549107200,ves:129071530155,jup:0xd2088431b2a1400,sat:0x3ee37dea29c61e0,ura:0x99ad2c257ccb88,nep:0xb54f909dc5b7b8,plu:7327611364884,eri:827117568e4},ct={sol:"☉",mer:"☿",ven:"♀",ter:"⊕",lun:"●",mar:"♂",cer:"⚳",ves:"⚶",jup:"♃",sat:"♄",ura:"♅",nep:"♆",plu:"♇",eri:"⚪"},pt=23.43928*Z,ut=Math.sin(pt),dt=Math.cos(pt),ft=["a","e","i","w","M","L","W","N","n","ep","ref","lecl","becl","Tilt"],ht=function(){function t(t){return b(t)}function e(t,e){for(var a=e>1?t*t:-t*t,n=e*a*t/6,r=(1-e)*t-n,i=4;Math.abs(n)>1e-15;)n*=a/(i*(i+1)),r-=n,i+=2;return r}function n(t){var a,n,r,i,o=t.e,l=t.M,s=1e-8,c=0,p=1.9,u=!1,d=0;if(!l)return 0;if(1>o&&((l<-Math.PI||l>Math.PI)&&(i=rt.normalize0(l),c=l-i,l=i),.9>o)){a=Math.atan2(Math.sin(l),Math.cos(l)-o);do n=(a-o*Math.sin(a)-l)/(1-o*Math.cos(a)),a-=n;while(Math.abs(n)>s);return a}if(0>l&&(l=-l,u=!0),a=l,s*=Math.abs(1-o),1e-15>s&&(s=1e-15),(o>.8&&l<Math.PI/3||o>1)&&(r=l/Math.abs(1-o),r*r>6*Math.abs(1-o)&&(r=l<Math.PI?Math.pow(6*l,1/3):rt.asinh(l/o)),a=r),o>1&&l>4&&(a=Math.log(l)),1>o)for(;Math.abs(p)>s;)n=d++>8?e(a,o)-l:a-o*Math.sin(a)-l,p=-n/(1-o*Math.cos(a)),a+=p;else for(;Math.abs(p)>s;)n=d++>7?-e(a,o)-l:o*rt.sinh(a)-a-l,p=-n/(o*rt.cosh(a)-1),a+=p;return u?c-a:c+a}function r(t){var e,a,r,i,o;1===t.e?(o=t.jd0-t.T,i=t.w0*o*.5,a=Math.pow(i+Math.sqrt(i*i+1),1/3),t.v=2*Math.atan(a-1/a)):(t.E=n(t),t.e>1?(e=t.e-rt.cosh(t.E),a=rt.sinh(t.E)):(e=Math.cos(t.E)-t.e,a=Math.sin(t.E)),a*=Math.sqrt(Math.abs(1-t.e*t.e)),t.v=Math.atan2(a,e)),r=t.q*(1+t.e),t.r=r/(1+t.e*Math.cos(t.v))}function i(t){t.hasOwnProperty("w")||(t.w=t.W-t.N),t.hasOwnProperty("M")||(t.M=t.L-t.W),t.e<1&&(t.M=rt.normalize0(t.M)),t.P=J*Math.sqrt(Math.pow(t.a,3)/h)/365.25,t.T=t.jd0-t.M/Q/t.P,1!==t.e?(t.q=t.a*(1-t.e),t.t0=t.a*Math.sqrt(Math.abs(t.a)/h)):(t.w0=3/Math.sqrt(2)/(t.q*Math.sqrt(t.q/h)),t.a=0,t.t0=0),t.am=Math.sqrt(h*t.q*(1+t.e))}function o(){if(!y.ref||"ecl"===y.ref)return y.tx=y.x,y.ty=y.y,void(y.tz=y.z);var t=y.lecl,e=Math.PI/2-y.becl,n=[0,e,-t];a(y,n);var r=rt.cartesian([y.tl,y.tb,y.r]);y.tx=r.x,y.ty=r.y,y.tz=r.z}function l(t){pt=(23.439292-.0130042*y.cy-1.667e-7*y.cy*y.cy+5.028e-7*y.cy*y.cy*y.cy)*Z,ut=Math.sin(pt),dt=Math.cos(pt),y.xeq=y.x-t.x,y.yeq=(y.y-t.y)*dt-(y.z-t.z)*ut,y.zeq=(y.y-t.y)*ut+(y.z-t.z)*dt,y.ra=rt.normalize(Math.atan2(y.yeq,y.xeq)),y.dec=Math.atan2(y.zeq,Math.sqrt(y.xeq*y.xeq+y.yeq*y.yeq)),y.pos=[y.ra/Z,y.dec/Z],y.rt=Math.sqrt(y.xeq*y.xeq+y.yeq*y.yeq+y.zeq*y.zeq)}function s(){var t=y.v+y.w;return y.x=y.r*(Math.cos(y.N)*Math.cos(t)-Math.sin(y.N)*Math.sin(t)*Math.cos(y.i)),y.y=y.r*(Math.sin(y.N)*Math.cos(t)+Math.cos(y.N)*Math.sin(t)*Math.cos(y.i)),y.z=y.r*Math.sin(t)*Math.sin(y.i),y}function c(){var t,e;return t=Math.atan2(y.y,y.x),e=Math.atan2(y.z,Math.sqrt(y.x*y.x+y.y*y.y)),y.l=rt.normalize(t),y.b=e,y}function p(t){var e=t.getUTCFullYear(),a=t.getUTCMonth()+1,n=t.getUTCDate(),r=(t.getUTCHours()-12+t.getUTCMinutes()/60+t.getUTCSeconds()/3600)/24,i=-4799;if(i>e)return-1;var o=Math.floor((14-a)/12),l=e+4800-o,s=a+12*o-3,c=n+Math.floor((153*s+2)/5)+365*l+Math.floor(l/4)-Math.floor(l/100)+Math.floor(l/400)-32045;return c+r}var u,d,f,h=st.sol,m="sol",g=[],y={},b=function(e){var a,n;e&&(a=e instanceof Date?e:k(e)),a||(a=new Date),y.jd=p(a),a=k(g.ep),y.jd0=p(a),y.d=y.jd-y.jd0,y.cy=y.d/36524.22;for(var o=0;o<ft.length;o++)n=ft[o],v(g,n)&&(v(g,"d"+n)?y[n]=g[n]+g["d"+n]*y.cy:v(g,n)&&(y[n]=g[n]));return v(y,"M")&&!v(y,"dM")&&v(y,"n")&&(y.M+=y.n*y.d),i(y),r(y),s(),t};return t.cartesian=function(){return y},t.spherical=function(){return c(),y},t.equatorial=function(t){return l(t),y},t.transpose=function(){return o(y),y},t.elements=function(e){var a;if(!arguments.length)return g;for(var n=0;n<ft.length;n++)a=ft[n],v(e,a)&&(g[a]=e[a],"a"===a||"e"===a?g[a]*=1:"ref"!==a&&"ep"!==a&&(g[a]*=Z),v(e,"d"+a)&&(a="d"+a,g[a]=e[a],g[a]*="da"===a||"de"===a?1:Z));return t},t.parentBody=function(e){return arguments.length?(m=e,h=st[m],t):m},t.id=function(e){return arguments.length?(u=e,f=ct[e],t):u},t.name=function(e){return arguments.length?(d=e,t):d},t.symbol=function(e){return arguments.length?(f=ct[e],t):f},t},mt=function(t){function e(){var t=f("mon").value,e=f("yr").value,a=new Date(e,t,1),n=d3.select("#cal"),r=new Date;e=parseInt(e),t=parseInt(t),a.setDate(a.getDate()-a.getDay());for(var i=n.node();i.firstChild;)i.removeChild(i.firstChild);for(var o=0;42>o;o++){var l=a.getMonth(),s=a.getDay(),c=y(a);n.append("div").classed({date:!0,grey:l!==t,weekend:l===t&&(0===s||6===s),today:0===x(a,r),selected:0===x(a,d)}).attr("id",c).on("click",u).html(a.getDate().toString()),a.setDate(a.getDate()+1)}}function a(){var t=b.append("select").attr("title","Year").attr("id","yr").on("change",e),a=0,n=d.getFullYear();t.selectAll("option").data(v).enter().append("option").text(function(t,e){return t===n&&(a=e),t.toString()}),t.property("selectedIndex",a)}function n(){var t=b.append("select").attr("title","Month").attr("id","mon").on("change",e),a=0,n=d.getMonth();t.selectAll("option").data(g).enter().append("option").attr("value",function(t,e){return e===n&&(a=e),e}).text(function(t){return t}),t.property("selectedIndex",a)}function r(t){b.append("div").attr("id",t).on("click",function(){var a=f("mon"),n=f("yr");"left"===t?0===a.selectedIndex?(a.selectedIndex=11,n.selectedIndex--):a.selectedIndex--:11===a.selectedIndex?(a.selectedIndex=0,n.selectedIndex++):a.selectedIndex++,e()})}function i(){b.append("input").attr("type","number").attr("id","hr").attr("title","Hours").attr("max","24").attr("min","-1").attr("step","1").attr("value",d.getHours()).on("change",function(){j(this)===!0&&u()}),b.append("input").attr("type","number").attr("id","min").attr("title","Minutes").attr("max","60").attr("min","-1").attr("step","1").attr("value",d.getMinutes()).on("change",function(){j(this)===!0&&u()}),b.append("input").attr("type","number").attr("id","sec").attr("title","Seconds").attr("max","60").attr("min","-1").attr("step","1").attr("value",d.getSeconds()).on("change",function(){j(this)===!0&&u()})}function o(){var t=b.append("select").attr("title","Time zone offset from UTC").attr("id","tz").on("change",u),e=15,a=d.getTimezoneOffset();t.selectAll("option").data(m).enter().append("option").attr("value",function(t,n){var r=Object.keys(t)[0];return t[r]===a&&(e=n),t[r]}).text(function(t){return Object.keys(t)[0]}),t.property("selectedIndex",e)}function l(t){for(var e=t.getFullYear(),a=[],n=e-10;e+10>=n;n++)a.push(n);return a}function s(t,e){for(var a=f(t),n=0;n<a.childNodes.length;n++)if(a.childNodes[n].value==e){a.selectedIndex=n;break}}function c(t){t&&d.setTime(t.valueOf()),s("yr",d.getFullYear()),s("mon",d.getMonth()),e(),f("hr").value=d.getHours(),f("min").value=d.getMinutes(),f("sec").value=d.getSeconds()}function p(){d3.select("#celestial-date").style("opacity",0),d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),d3.select("#datepick").classed("active",!1),setTimeout(function(){f("celestial-date").style.top=h(-9999)},600)}function u(){var e=f("hr").value,a=f("min").value,n=f("sec").value,r=f("tz").value;this.id&&-1!==this.id.search(/^\d/)&&(d=y.parse(this.id)),d.setHours(e,a,n),c(),t(d,r)}var d=new Date,m=(d3.time.format("%Z"),[{"−12:00":720},{"−11:00":660},{"−10:00":600},{"−09:30":570},{"−09:00":540},{"−08:00":480},{"−07:00":420},{"−06:00":360},{"−05:00":300},{"−04:30":270},{"−04:00":240},{"−03:30":210},{"−03:00":180},{"−02:00":120},{"−01:00":60},{"±00:00":0},{"+01:00":-60},{"+02:00":-120},{"+03:00":-180},{"+03:30":-210},{"+04:00":-240},{"+04:30":-270},{"+05:00":-300},{"+05:30":-330},{"+05:45":-345},{"+06:00":-360},{"+06:30":-390},{"+07:00":-420},{"+08:00":-480},{"+08:30":-510},{"+08:45":-525},{"+09:00":-540},{"+09:30":-570},{"+10:00":-600},{"+10:30":-630},{"+11:00":-660},{"+12:00":-720},{"+12:45":-765},{"+13:00":-780},{"+14:00":-840}]),g=["January","February","March","April","May","June","July","August","September","October","November","December"],v=l(d),y=d3.time.format("%Y-%m-%d"),b=d3.select("#celestial-form").append("div").attr("id","celestial-date");r("left"),n(),a(),r("right");b.append("div").attr("id","cal");e(),i(),o(),this.show=function(t){var e=f("celestial-date"),a=f("datepick"),n=a.offsetLeft+a.offsetWidth-e.offsetWidth,r=a.offsetTop-e.offsetHeight-1;-9999===e.offsetTop?(d.setTime(t.valueOf()),c(),d3.select("#celestial-date").style({top:h(r),left:h(n),opacity:1}),d3.select("#datepick").classed("active",!0)):p()},this.isVisible=function(){return-9999!==f("celestial-date").offsetTop},this.hide=function(){p()}};!function(){function t(t,e,a){var n=t.translate(),r=Math.atan2(e[1]-n[1],e[0]-n[0])-Math.atan2(a[1]-n[1],a[0]-n[0]);return[Math.cos(r/2),0,0,Math.sin(r/2)]}function e(t,e){var a=t.invert(e);return a&&isFinite(a[0])&&isFinite(a[1])&&l(a)}function a(t){var e=.5*t[0]*u,a=.5*t[1]*u,n=.5*t[2]*u,r=Math.sin(e),i=Math.cos(e),o=Math.sin(a),l=Math.cos(a),s=Math.sin(n),c=Math.cos(n);return[i*l*c+r*o*s,r*l*c-i*o*s,i*o*c+r*l*s,i*l*s-r*o*c]}function n(t,e){var a=t[0],n=t[1],r=t[2],i=t[3],o=e[0],l=e[1],s=e[2],c=e[3];return[a*o-n*l-r*s-i*c,a*l+n*o+r*c-i*s,a*s-n*c+r*o+i*l,a*c+n*s-r*l+i*o]}function r(t,e){if(t&&e){var a=c(t,e),n=Math.sqrt(s(a,a)),r=.5*Math.acos(Math.max(-1,Math.min(1,s(t,e)))),i=Math.sin(r)/n;return n&&[Math.cos(r),a[2]*i,-a[1]*i,a[0]*i]}}function i(t,e){var a=Math.max(-1,Math.min(1,s(t,e))),n=0>a?-1:1,r=Math.acos(n*a),i=Math.sin(r);return i?function(a){var o=n*Math.sin((1-a)*r)/i,l=Math.sin(a*r)/i;return[t[0]*o+e[0]*l,t[1]*o+e[1]*l,t[2]*o+e[2]*l,t[3]*o+e[3]*l]}:function(){return t}}function o(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*d,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*d,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*d]}function l(t){var e=t[0]*u,a=t[1]*u,n=Math.cos(a);return[n*Math.cos(e),n*Math.sin(e),Math.sin(a)]}function s(t,e){for(var a=0,n=t.length,r=0;n>a;++a)r+=t[a]*e[a];return r}function c(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function p(t){for(var e=0,a=arguments.length,n=[];++e<a;)n.push(arguments[e]);var r=d3.dispatch.apply(null,n);return r.of=function(e,a){return function(n){try{var i=n.sourceEvent=d3.event;n.target=t,d3.event=n,r[n.type].apply(e,a)}finally{d3.event=i}}},r}var u=Math.PI/180,d=180/Math.PI;d3.geo.zoom=function(){function s(t){m++||t({type:"zoomstart"})}function c(t){t({type:"zoom"})}function u(t){--m||t({type:"zoomend"})}var d,f,h,m=0,g=p(v,"zoomstart","zoom","zoomend"),v=d3.behavior.zoom().on("zoomstart",function(){var i=d3.mouse(this),l=a(d.rotate()),p=e(d,i);p&&(h=p),y.call(v,"zoom",function(){d.scale(b.k=d3.event.scale);var a=d3.mouse(this),s=r(h,e(d,a));d.rotate(b.r=o(l=s?n(l,s):n(t(d,i,a),l))),i=a,c(g.of(this,arguments))}),s(g.of(this,arguments))}).on("zoomend",function(){y.call(v,"zoom",null),u(g.of(this,arguments))}),y=v.on,b={r:[0,0,0],k:1};return v.rotateTo=function(t){var e=r(l(t),l([-b.r[0],-b.r[1]]));return o(n(a(b.r),e))},v.projection=function(t){return arguments.length?(d=t,b={r:d.rotate(),k:d.scale()},v.scale(b.k)):d},v.duration=function(t){return arguments.length?(f=t,v):f},v.event=function(t){t.each(function(){var t=d3.select(this),e=g.of(this,arguments),n=b,r=d3.transition(t);if(r!==t){r.each("start.zoom",function(){this.__chart__&&(b=this.__chart__),d.rotate(b.r).scale(b.k),s(e)}).tween("zoom:zoom",function(){var t=v.size()[0],l=i(a(b.r),a(n.r)),s=d3.geo.distance(b.r,n.r),p=d3.interpolateZoom([0,0,t/b.k],[s,0,t/n.k]);return f&&r.duration(f(.001*p.duration)),function(a){var n=p(a);this.__chart__=b={r:o(l(n[0]/s)),k:t/n[2]},d.rotate(b.r).scale(b.k),v.scale(b.k),c(e)}}).each("end.zoom",function(){u(e)});try{r.each("interrupt.zoom",function(){u(e)})}catch(l){console.log(l)}}else this.__chart__=b,s(e),c(e),u(e)})},d3.rebind(v,g,"on")}}(),this.Celestial=_}();