var settings={width:1024,height:512,projection:"aitoff",transform:null,bgcolor:"#000",stars:{show:!0,limit:6,colors:!0,color:"#fff",names:!0,proper:!1,desig:!0,namelimit:2},constellations:{show:!0,names:!0,desig:!0,lines:!0,bounds:!1},dsos:{show:!0,limit:6,names:!0,desig:!0,namelimit:4},mw:{show:!0,opacity:.55},lines:{graticule:!0,ecliptic:!0,galactic:!1,equatorial:!1,supergalactic:!1}},symbols={gg:{shape:"circle",stroke:"#f00",fill:"#f00"},g:{shape:"ellipse",stroke:"#f00",fill:"#f00"},s:{shape:"ellipse",stroke:"#f00",fill:"#f00"},s0:{shape:"ellipse",stroke:"#f00",fill:"#f00"},sd:{shape:"ellipse",stroke:"#f00",fill:"#f00"},e:{shape:"ellipse",stroke:"#f00",fill:"#f00"},i:{shape:"ellipse",stroke:"#f00",fill:"#f00"},oc:{shape:"circle",stroke:"#fc0",fill:"none"},gc:{shape:"circle",stroke:"#f90",fill:"#f90"},en:{shape:"square",stroke:"#f0c",fill:"#f0c"},bn:{shape:"square",stroke:"#f0c",fill:"none"},sfr:{shape:"square",stroke:"#c0f",fill:"none"},rn:{shape:"square",stroke:"#00f",fill:"#00f"},pn:{shape:"diamond",stroke:"#0c0",fill:"#0cc"},snr:{shape:"diamond",stroke:"#f0c",fill:"#f0c"},dn:{shape:"square",stroke:"#999",fill:"none"}},starcolor=d3.scale.quantize().domain([-.4,3.332]).range(["#a5b7ff","#a6b9ff","#a7baff","#a8bbff","#a9bcff","#aabcff","#abbeff","#adc0ff","#afc2ff","#b1c4ff","#b3c5ff","#b5c7ff","#b8c9ff","#bbcbff","#bdcdff","#c0ceff","#c3d1ff","#c5d4ff","#c7d7ff","#cad9ff","#cedcff","#d2dfff","#d7e1ff","#dbe4ff","#e0e7ff","#e5e9ff","#e9ecff","#edefff","#f1f2ff","#f4f4ff","#f8f7ff","#fbf8ff","#fdf9ff","#fffafe","#fffbfd","#fffbfc","#fffbfb","#fffaf7","#fff9f3","#fff8f0","#fff7ec","#fff6e7","#fff5e1","#fff3dc","#fff2d7","#fff0cf","#ffedc8","#ffeac1","#ffe8ba","#ffe5b3","#ffe2ad","#ffe0a6","#ffdda1","#ffda9b","#ffd896","#ffd790","#ffd58c","#ffd387","#ffd183","#ffcf7f","#ffce7c","#ffcd79","#ffcc77","#ffcb75","#ffca74","#ffc870","#ffc76f","#ffc66e","#ffc56d","#ffc46c","#ffc36b","#ffc26a","#ffc169","#ffc068","#ffbf67","#ffbe66","#ffbd65","#ffbc64","#ffbb63","#ffba62","#ffb961","#ffb860","#ffb75f","#ffb65e","#ffb55d","#ffb45c","#ffb35b","#ffb25a","#ffb159","#ffb058","#ffaf57","#ffar56","#ffad55","#ffac54","#ffab53","#ffaa52","#ffa951","#ffa850","#ffa74f","#ffa64e","#ffa54d","#ffa44c","#ffa34b","#ffa24a","#ffa149","#ffa048","#ff9f47","#ff9e46","#ff9d45","#ff9c44","#ff9b43","#ff9a42","#ff9941","#ff983f","#ff973e"]),projections={aitoff:{arg:null,scale:162},armadillo:{arg:0,scale:250},baker:{arg:null,scale:160,ratio:1.4},boggs:{arg:null,scale:170},bromley:{arg:null,scale:162},collignon:{arg:null,scale:100,ratio:2.6},cylindricalEqualArea:{arg:Math.PI/6,scale:180},cylindricalStereographic:{arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{arg:null,scale:175},eckert2:{arg:null,scale:175},eckert3:{arg:null,scale:190},eckert4:{arg:null,scale:190},eckert5:{arg:null,scale:182},eckert6:{arg:null,scale:182},eisenlohr:{arg:null,scale:102},equirectangular:{arg:null,scale:160},fahey:{arg:null,scale:196,ratio:1.4},foucaut:{arg:null,scale:142},ginzburg4:{arg:null,scale:180,ratio:1.7},ginzburg5:{arg:null,scale:196,ratio:1.55},ginzburg6:{arg:null,scale:190,ratio:1.4},ginzburg8:{arg:null,scale:205,ratio:1.3},ginzburg9:{arg:null,scale:190,ratio:1.4},hammer:{arg:2,scale:180},hill:{arg:2,scale:190,ratio:1.6},homolosine:{arg:null,scale:160,ratio:2.2},kavrayskiy7:{arg:null,scale:185,ratio:1.75},larrivee:{arg:null,scale:160,ratio:1.25},laskowski:{arg:null,scale:165,ratio:1.7},loximuthal:{arg:Math.PI/4,scale:170,ratio:1.8},mercator:{arg:null,scale:160,ratio:1.3},miller:{arg:null,scale:160,ratio:1.5},mollweide:{arg:null,scale:180},mtFlatPolarParabolic:{arg:null,scale:175},mtFlatPolarQuartic:{arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{arg:null,scale:175,ratio:1.9},naturalEarth:{arg:null,scale:185,ratio:1.85},nellHammer:{arg:null,scale:160,ratio:2.6},patterson:{arg:null,scale:160,ratio:1.75},polyconic:{arg:null,scale:160,ratio:1.3},rectangularPolyconic:{arg:0,scale:160,ratio:1.65},robinson:{arg:null,scale:160},times:{arg:null,scale:210,ratio:1.4},vanDerGrinten:{arg:null,scale:160,ratio:1},vanDerGrinten2:{arg:null,scale:160,ratio:1},vanDerGrinten3:{arg:null,scale:160,ratio:1},vanDerGrinten4:{arg:null,scale:160,ratio:1.6},wagner4:{arg:null,scale:185},wagner6:{arg:null,scale:160},wagner7:{arg:null,scale:190,ratio:1.8},winkel3:{arg:null,scale:196,ratio:1.7}},Celestial={};Celestial.display=function(e){function t(e){var t=s(e.mag,e.dim)||9,r=a(e.type);return-1!==d3.svg.symbolTypes.indexOf(r)?d3.svg.symbol().type(r).size(t)():d3.svg.customSymbol().type(r).size(t)()}function a(e){return e&&symbols.hasOwnProperty(e)?symbols[e].shape:"circle"}function r(e,t){return e&&symbols.hasOwnProperty(e)?symbols[e][t]:"none"}function s(e,t){return e&&999!=e?Math.pow(14-e,1.4):Math.pow(parseInt(t),.5)}function n(e){return 999==e.mag&&Math.sqrt(parseInt(e.dim))<settings.dsos.namelimit||999!=e.mag&&e.mag>settings.dsos.namelimit||""===e.name?void 0:settings.dsos.desig&&e.desig?e.desig:e.name}function f(e){return e.mag>settings.stars.namelimit||settings.stars.desig===!1&&""===e.name?void 0:settings.stars.proper&&""!==e.name?e.name:settings.stars.desig?e.desig:void 0}function l(e){if(null===e)return.3;var t=Math.pow(5.6-e,.66);return t>.5?t:.3}function i(e){return[e[0]-1.5,e[1]+1.5]}if(projections.hasOwnProperty(settings.projection)){var o=projections[settings.projection],c=o.ratio||2,u=settings.width,g=u/c,p=Celestial.projection(settings.projection,settings.transform).translate([u/2,g/2]).scale([o.scale]),d=Celestial.projection(settings.projection).translate([u/2,g/2]).scale([o.scale]),h=d3.geo.graticule().minorStep([15,10]),m=d3.geo.path().projection(p),b=d3.geo.path().projection(d),y=d3.select("body").append("svg").attr("width",u).attr("height",g);y.append("path").datum(h.outline).attr("class","graticule outline").attr("d",b),y.append("path").datum(h).attr("class","graticule").attr("d",b),settings.mw.show&&d3.json("data/mw.json",function(e,t){y.selectAll(".mw").data(t.features).enter().append("path").attr("d",m).style("fill","#fff").style("opacity",settings.mw.opacity/5)}),settings.constellations.show&&d3.json("data/constellations.json",function(e,t){y.selectAll(".names").data(t.features).enter().append("text").attr("transform",function(e,a){return"translate("+p(t.features[a].geometry.coordinates)+")"}).text(function(e,a){return settings.constellations.desig?t.features[a].properties.desig:t.features[a].properties.name}).attr("class","constname")}),settings.constellations.bounds&&d3.json("data/constellations.bounds.json",function(e,t){y.selectAll(".bounds").data(t.features).enter().append("path").attr("d",m).attr("class","boundaryline")}),settings.constellations.lines&&d3.json("data/constellations.lines.json",function(e,t){y.selectAll(".lines").data(t.features).enter().append("path").attr("d",m).attr("class","constline")}),settings.stars.show&&d3.json("data/stars.6.json",function(e,t){y.selectAll(".stars").data(t.features).enter().append("circle").attr("r",function(e,a){return l(t.features[a].properties.mag)}).attr("transform",function(e,a){return"translate("+p(t.features[a].geometry.coordinates)+")"}).style("fill",function(e,a){return settings.stars.colors&&t.features[a].properties.mag<5?starcolor(t.features[a].properties.bv):settings.stars.color}),settings.stars.names&&y.selectAll(".starnames").data(t.features).enter().append("text").attr("transform",function(e,a){return"translate("+p(i(t.features[a].geometry.coordinates))+")"}).text(function(e,a){return f(t.features[a].properties)}).attr("class","starname")}),settings.dsos.show&&d3.json("data/dsos.bright.json",function(e,a){y.selectAll(".dso").data(a.features).enter().append("path").attr("transform",function(e,t){return"translate("+p(a.features[t].geometry.coordinates)+")"}).attr("d",function(e,r){return t(a.features[r].properties)}).style("stroke",function(e,t){return r(a.features[t].properties.type,"stroke")}).style("fill",function(e,t){return r(a.features[t].properties.type,"fill")}),settings.dsos.names&&y.selectAll(".dsonames").data(a.features).enter().append("text").attr("transform",function(e,t){return"translate("+p(i(a.features[t].geometry.coordinates))+")"}).text(function(e,t){return n(a.features[t].properties)}).style("fill",function(e,t){return r(a.features[t].properties.type,"stroke")})});for(var v in settings.lines)if(settings.lines.hasOwnProperty(v)&&"graticule"!=v&&settings.lines[v]!==!1){var M=Celestial.plane(v);y.selectAll(".pl"+v).data(M.features).enter().append("path").attr("d",m).attr("class",v)}}},Celestial.projection=function(e,t){var a,r,s;if(!projections.hasOwnProperty(e))throw new Error("Projection not supported: "+e);return a=projections[e],r=null!==a.arg?d3.geo[e].raw(a.arg):d3.geo[e].raw,s=t?function(e,t){var a=Celestial.transform(e,t);return a=r(-a[0],a[1])}:function(e,t){var a=r(-e,t);return a},s.invert=function(e,t){var a=r.invert(e,t);return a[0]*=-1,a},d3.geo.projection(s)};var pi2=2*Math.PI,pi_2=Math.PI/2,deg2rad=Math.PI/180;Celestial.plane=function(e){var t,a,r=[],s=function(e,t){var a={type:"FeatureCollection",features:[]};return a.features[0]={type:"Feature",id:e,properties:{},geometry:{}},a.features[0].geometry.type="LineString",a.features[0].geometry.coordinates=t,a};if("equatorial"==e)for(t=-180;180>=t;t+=1)r.push([t,0]);else{if(a="inverse "+e,!euler.hasOwnProperty(a))return null;for(t=0;pi2>=t;t+=.05)r.push(Celestial.transform([t,0],euler[a]).map(function(e){return e/deg2rad}))}return s(e,r)},Celestial.transform=function(e,t){var a,r,s,n,f,l,i,o,c,u,g=1e-5;return t?(l=e[0],i=e[1],l-=t[0],n=t[1],f=t[2],a=Math.sin(i)*Math.sin(n)-Math.cos(i)*Math.cos(n)*Math.cos(l),Math.abs(a)<g&&(a=-Math.cos(i+n)+Math.cos(i)*Math.cos(n)*(1-Math.cos(l))),r=-Math.cos(i)*Math.sin(l),o=0!==a||0!==r?Math.atan2(r,a):l-Math.PI,c=(f+o+pi2)%pi2,l%Math.PI===0?(u=i+Math.cos(l)*n,u>pi_2&&(u=Math.PI-u),-pi_2>u&&(u=-Math.PI-u)):(s=Math.sin(i)*Math.cos(n)+Math.cos(i)*Math.sin(n)*Math.cos(l),Math.abs(s)>.99?(u=Math.abs(Math.acos(Math.sqrt(a*a+r*r))),0>s&&(u*=-1)):u=Math.asin(s)),[c-Math.PI,u]):e};var euler={ecliptic:[270,23.4393,90],"inverse ecliptic":[90,23.4393,270],galactic:[192.8595,62.8717,122.9319],"inverse galactic":[238.9319,62.8717,192.8595],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[334.4504,74.2911,283.7542],init:function(){for(var e in this)this[e].constructor==Array&&(this[e]=this[e].map(function(e){return e*deg2rad}))},add:function(e,t){return t&&e&&3===t.length&&!this.hasOwnProperty(e)?(this[e]=t.map(function(e){return e*deg2rad}),this[e]):void 0}};euler.init();var customSymbolTypes=d3.map({ellipse:function(e){var t=Math.sqrt(e),a=.666*t,r=t/3;return"M"+-a+","+-r+" m"+-a+",0 a"+a+","+r+" 0 1,0"+2*a+",0 a"+a+","+r+" 0 1,0"+-(2*a)+",0"}});d3.svg.customSymbol=function(){function e(e,r){return customSymbolTypes.get(t.call(this,e,r))(a.call(this,e,r))}var t,a=64;return e.type=function(a){return arguments.length?(t=d3.functor(a),e):t},e.size=function(t){return arguments.length?(a=d3.functor(t),e):a},e};